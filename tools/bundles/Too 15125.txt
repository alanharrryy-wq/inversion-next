

/* ===== FILE: package.json ===== */
{
  "name": "inversion-next",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview",
    "lint": "eslint .",
    "test": "vitest run",
    "test:watch": "vitest",
    "rts:gen": "node scripts/rts/gen-slide.mjs",
    "rts:check": "node scripts/rts/check.mjs"
  },
  "dependencies": {
    "@radix-ui/react-dialog": "^1.1.5",
    "@radix-ui/react-slot": "^1.1.2",
    "@tanstack/react-query": "^5.59.0",
    "@tanstack/react-query-devtools": "^5.59.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "framer-motion": "^12.24.12",
    "lucide-react": "^0.453.0",
    "msw": "^2.6.0",
    "ogl": "^1.0.11",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-markdown": "^10.1.0",
    "react-router-dom": "^6.28.0",
    "recharts": "^3.6.0",
    "simplex-noise": "^4.0.3",
    "tailwind-merge": "^2.6.0",
    "usehooks-ts": "^3.1.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.17.0",
    "@tailwindcss/vite": "^4.0.0",
    "@types/node": "^22.10.0",
    "@types/react": "^18.2.66",
    "@types/react-dom": "^18.2.22",
    "@vitejs/plugin-react": "^4.3.4",
    "eslint": "^9.17.0",
    "eslint-plugin-react-hooks": "^5.1.0",
    "eslint-plugin-react-refresh": "^0.4.15",
    "jsdom": "^27.4.0",
    "madge": "^8.0.0",
    "playwright": "^1.57.0",
    "typescript": "^5.8.2",
    "typescript-eslint": "^8.18.0",
    "vite": "^5.4.11",
    "vitest": "^2.1.8"
  },
  "overrides": {
    "esbuild": "^0.25.0"
  }
}


/* ===== FILE: src/app/App.tsx ===== */
import { HashRouter, Navigate, Route, Routes } from "react-router-dom"
import { Providers } from "@/app/providers/Providers"
import { DeckPage } from "@/pages/deck/DeckPage"
import { NotFoundPage } from "@/pages/not-found/NotFoundPage"

import { CommandPalette } from "@/shared/ui/command-palette/CommandPalette"
import HiShaderBackground from "@/components/hi/HiShaderBackground"

export function App() {
  return (
    <Providers>
      <HiShaderBackground />
      <CommandPalette />

      <HashRouter>
        <Routes>
          <Route path="/" element={<Navigate to="/deck" replace />} />
          <Route path="/deck" element={<DeckPage />} />
          <Route path="*" element={<NotFoundPage />} />
        </Routes>
      </HashRouter>
    </Providers>
  )
}


/* ===== FILE: src/app/deck/slideRegistry.ts ===== */
import { lazy } from "react"
import type { SlideEntry } from "@/app/deck/deck.types"

export const slideRegistry: SlideEntry[] = [
  {
    meta: { id: "slide-00", title: "Portada", tags: ["intro"] },
    Component: lazy(() => import("@/slides/slide-00").then(m => ({ default: m.default }))),
  },
  {
    meta: { id: "slide-01", title: "Agenda", tags: ["overview"] },
    Component: lazy(() => import("@/slides/slide-01").then(m => ({ default: m.default }))),
  },
  {
    meta: { id: "slide-02", title: "RTS: Executive Narrative", tags: ["rts", "executive"] },
    Component: lazy(() => import("@/slides/slide-02").then(m => ({ default: m.default }))),
  },

  {
    meta: { id: "slide-03", title: "RTS: Problem / Context", tags: ["rts", "context"] },
    Component: lazy(() => import("@/slides/slide-03").then(m => ({ default: m.default }))),
  },
  {
    meta: { id: "slide-04", title: "RTS: Solution / System Overview", tags: ["rts", "solution"] },
    Component: lazy(() => import("@/slides/slide-04").then(m => ({ default: m.default }))),
  },
  {
    meta: { id: "slide-05", title: "RTS: KPI Dashboard", tags: ["rts", "kpi"] },
    Component: lazy(() => import("@/slides/slide-05").then(m => ({ default: m.default }))),
  },
  {
    meta: { id: "slide-06", title: "RTS: Timeline / Roadmap", tags: ["rts", "roadmap"] },
    Component: lazy(() => import("@/slides/slide-06").then(m => ({ default: m.default }))),
  },
  {
    meta: { id: "slide-07", title: "RTS: Risks and Next Steps", tags: ["rts", "risks"] },
    Component: lazy(() => import("@/slides/slide-07").then(m => ({ default: m.default }))),
  },
]



/* ===== FILE: src/app/providers/Providers.tsx ===== */
import type { ReactNode } from "react"
import { QueryClient, QueryClientProvider } from "@tanstack/react-query"
import { ReactQueryDevtools } from "@tanstack/react-query-devtools"
import { RtsDebugOverlay } from "@/rts/devtools/RtsDebugOverlay"

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 30_000,
    },
  },
})

export function Providers(props: { children: ReactNode }) {
  return (
    <QueryClientProvider client={queryClient}>
      {props.children}
      <RtsDebugOverlay />x
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  )
}


/* ===== FILE: src/app/styles/globals.css ===== */
:root {
  color: var(--c-fg);
  background: var(--c-bg);
}

html, body, #root {
  height: 100%;
}

body {
  margin: 0;
  font-family: var(--font-sans);
}

* {
  box-sizing: border-box;
}

::selection {
  background: color-mix(in oklab, var(--c-accent) 35%, transparent);
}

a {
  color: inherit;
}

/* =========================
   HITECH | Premium Glass + Metal
   Fecha: 2026-01-08
========================= */

:root{
  --bg0: #0b0f14;
  --bg1: #0f1622;
  --panel: rgba(255,255,255,0.06);
  --panel2: rgba(255,255,255,0.04);
  --stroke: rgba(255,255,255,0.10);
  --stroke2: rgba(255,255,255,0.06);
  --text: rgba(245,247,250,0.95);
  --muted: rgba(245,247,250,0.65);

  /* accents (plateado/cyan) */
  --steel: rgba(170, 190, 210, 0.75);
  --cyan: rgba(2,167,202,0.85);
  --cyanGlow: rgba(2,167,202,0.18);
  --whiteGlow: rgba(255,255,255,0.10);
}

/* Fondo premium con viñeta + nebula suave */
.hi-bg-premium{
  background:
    radial-gradient(1200px 700px at 70% 20%, rgba(2,167,202,0.10), transparent 55%),
    radial-gradient(900px 600px at 25% 25%, rgba(255,255,255,0.06), transparent 60%),
    radial-gradient(1200px 700px at 50% 120%, rgba(255,255,255,0.06), transparent 60%),
    linear-gradient(180deg, var(--bg1), var(--bg0));
}

/* Grain (sin imagen) */
.hi-grain{
  position: relative;
  isolation: isolate;
}
.hi-grain::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index: 1;
  opacity: 0.20;
  mix-blend-mode: overlay;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.06) 0 1px, transparent 2px),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,0.05) 0 1px, transparent 2px),
    radial-gradient(circle at 40% 80%, rgba(255,255,255,0.04) 0 1px, transparent 2px);
  background-size: 18px 18px, 22px 22px, 26px 26px;
}

/* Panel glass + metal */
.hi-panel{
  position: relative;
  border-radius: 18px;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.09), rgba(255,255,255,0.03));
  border: 1px solid var(--stroke2);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.03) inset,
    0 14px 50px rgba(0,0,0,0.50),
    0 0 22px var(--cyanGlow);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  overflow: hidden;
}

/* Highlight superior “metal cepillado” */
.hi-panel::after{
  content:"";
  position:absolute;
  left:-40%;
  top:-55%;
  width: 180%;
  height: 110%;
  background:
    linear-gradient(135deg,
      rgba(255,255,255,0.10),
      rgba(255,255,255,0.04) 35%,
      rgba(255,255,255,0.02) 55%,
      rgba(255,255,255,0.00) 70%);
  transform: rotate(2deg);
  pointer-events:none;
  opacity: 0.8;
}

/* Borde exterior tipo “chasis” */
.hi-frame{
  border-radius: 28px;
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.05) inset,
    0 30px 110px rgba(0,0,0,0.65);
  overflow: hidden;
}

/* Text helpers */
.hi-title{
  color: var(--text);
  letter-spacing: 0.02em;
}
.hi-muted{ color: var(--muted); }

/* Bars delgadas elegantes */
.hi-bar{
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.10);
  overflow: hidden;
}
.hi-bar > span{
  display:block;
  height: 100%;
  border-radius: 999px;
  background:
    linear-gradient(90deg,
      rgba(255,255,255,0.35),
      rgba(170,190,210,0.55),
      rgba(2,167,202,0.45));
  box-shadow: 0 0 14px rgba(2,167,202,0.12);
}

body.deck-present {
  cursor: none;
}

body.deck-present * {
  cursor: none !important;
}

body.deck-print {
  background: #f5f7fa;
  color: #0b0f14;
}

body.deck-print .hi-shader-bg {
  display: none;
}

body.deck-print .rts-root {
  box-shadow: none;
}


/* ===== FILE: src/app/styles/hi-materials.css ===== */
/* ==========================================================================
   HITECH MATERIAL SYSTEM v4
   Objetivo: vidrio+metal realista (no SaaS blur), polvo/grain, rim irregular,
   glints direccionales, profundidad y espejo blur abajo.
   ========================================================================== */

:root {
  /* Base palette (match reference: dark steel, cyan only for data) */
  --hi-bg-0: #05080b;
  --hi-bg-1: #070c11;
  --hi-bg-2: #0b121a;

  --hi-panel-core: rgba(18, 26, 34, 0.62);
  --hi-panel-deep: rgba(6, 10, 14, 0.55);

  --hi-steel-a: rgba(255, 255, 255, 0.10);
  --hi-steel-b: rgba(255, 255, 255, 0.05);
  --hi-steel-c: rgba(255, 255, 255, 0.02);

  --hi-text: rgba(255, 255, 255, 0.86);
  --hi-text-dim: rgba(255, 255, 255, 0.66);

  --hi-cyan: rgba(76, 205, 255, 0.85);
  --hi-cyan-soft: rgba(76, 205, 255, 0.25);

  /* Blur control (no neon gamer) */
  --hi-blur: 14px;
  --hi-blur-soft: 10px;

  /* Shadows */
  --hi-shadow-out: 0 24px 80px rgba(0, 0, 0, 0.65);
  --hi-shadow-mid: 0 14px 40px rgba(0, 0, 0, 0.55);
  --hi-shadow-in: inset 0 1px 0 rgba(255, 255, 255, 0.06),
    inset 0 -18px 36px rgba(0, 0, 0, 0.55);

  --hi-radius-xl: 26px;
  --hi-radius-lg: 18px;

  /* Grain injected by JS (data-uri) */
  --hi-grain-url: none;
}

/* =========================
   GLOBAL BACKGROUND
   ========================= */

.hi-screen {
  color: var(--hi-text);
  position: relative;
  border-radius: var(--hi-radius-xl);
  overflow: hidden;
  background:
    radial-gradient(
      1200px 700px at 18% 22%,
      rgba(203, 203, 203, 0.12) 0%,
      rgba(203, 203, 203, 0.06) 22%,
      transparent 46%
    ),
    radial-gradient(
      900px 520px at 72% 30%,
      rgba(178, 178, 178, 0.10) 0%,
      rgba(178, 178, 178, 0.05) 22%,
      transparent 44%
    ),
    radial-gradient(
      1200px 900px at 55% 95%,
      rgba(255, 255, 255, 0.06) 0%,
      rgba(255, 255, 255, 0.03) 22%,
      transparent 46%
    ),
    linear-gradient(180deg, var(--hi-bg-2), var(--hi-bg-0));
  box-shadow: var(--hi-shadow-out);
}

/* dust field + vignette + subtle bloom */
.hi-screen::before {
  content: "";
  position: absolute;
  inset: -40px;
  background:
    radial-gradient(
      closest-side at 18% 18%,
      rgba(255, 255, 255, 0.05) 0%,
      rgba(255, 255, 255, 0.025) 20%,
      transparent 45%
    ),
    radial-gradient(
      closest-side at 78% 22%,
      rgba(201, 201, 201, 0.04) 0%,
      rgba(201, 201, 201, 0.02) 20%,
      transparent 45%
    ),
    radial-gradient(
      closest-side at 45% 92%,
      rgba(255, 255, 255, 0.04) 0%,
      rgba(255, 255, 255, 0.02) 18%,
      transparent 40%
    ),
    radial-gradient(
      1200px 800px at 50% 10%,
      rgba(255, 255, 255, 0.02) 0%,
      rgba(255, 255, 255, 0.01) 20%,
      transparent 45%
    ),
    linear-gradient(180deg, rgba(0, 0, 0, 0.18), rgba(0, 0, 0, 0.38));
  filter: blur(0.4px);
  opacity: 1;
  pointer-events: none;
}

/* Grain overlay (procedural) */
.hi-screen::after {
  content: "";
  position: absolute;
  inset: 0;
  background-image: var(--hi-grain-url);
  background-size: 320px 320px;
  opacity: 0.16;
  mix-blend-mode: overlay;
  pointer-events: none;
}

/* Base glass plane (behind panels) */
.hi-base-glass {
  position: absolute;
  inset: 12px;
  border-radius: calc(var(--hi-radius-xl) - 6px);
  pointer-events: none;
  z-index: 0;
  background:
    linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.14),
      rgba(255, 255, 255, 0.05) 12%,
      transparent 22%
    ),
    linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.08),
      rgba(255, 255, 255, 0.03) 22%,
      transparent 55%
    ),
    radial-gradient(
      130% 120% at 50% 50%,
      transparent 64%,
      rgba(255, 255, 255, 0.05) 90%,
      rgba(255, 255, 255, 0.08) 100%
    ),
    radial-gradient(
      220px 140px at 84% 88%,
      rgba(255, 255, 255, 0.08),
      transparent 62%
    ),
    radial-gradient(
      140% 120% at 50% 8%,
      rgba(255, 255, 255, 0.04),
      transparent 45%
    ),
    radial-gradient(
      120% 120% at 50% 50%,
      transparent 58%,
      rgba(0, 0, 0, 0.28) 100%
    );
  box-shadow:
    0 0 0 1px var(--hi-edge-outer),
    inset 0 0 0 1px var(--hi-edge-inner),
    0 18px 60px rgba(0, 0, 0, 0.45);
  opacity: 0.42;
}

/* =========================
   PANEL GLASS + METAL (7-9 layers)
   ========================= */

.hi-panel {
  position: relative;
  border-radius: var(--hi-radius-lg);
  overflow: hidden;
  --hi-edge-outer: var(--hi-edge-outer);
  --hi-edge-inner: var(--hi-edge-inner);
  --hi-spec-top-a: 0.16;
  --hi-spec-top-b: 0.06;
  --hi-spec-stop: 20%;
  --hi-spec-fade: 55%;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.10));
  box-shadow:
    0 0 0 1px var(--hi-edge-outer),
    inset 0 0 0 1px var(--hi-edge-inner),
    0 10px 22px rgba(0, 0, 0, 0.38),
    var(--hi-shadow-mid);
}

/* Layer 1: deep base */
.hi-panel::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      900px 480px at 30% 10%,
      rgba(255, 255, 255, 0.07) 0%,
      rgba(255, 255, 255, 0.035) 18%,
      transparent 42%
    ),
    radial-gradient(
      900px 540px at 70% 20%,
      rgba(181, 181, 181, 0.05) 0%,
      rgba(181, 181, 181, 0.025) 18%,
      transparent 42%
    ),
    radial-gradient(1200px 700px at 50% 120%, rgba(0, 0, 0, 0.75), transparent 60%),
    linear-gradient(180deg, var(--hi-panel-core), var(--hi-panel-deep));
  backdrop-filter: blur(var(--hi-blur));
  -webkit-backdrop-filter: blur(var(--hi-blur));
  opacity: 1;
}

/* Layer 2: inner volume + metallic shading */
.hi-panel::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(135deg, rgba(255, 255, 255, 0.06), transparent 42%),
    linear-gradient(315deg, rgba(255, 255, 255, 0.04), transparent 46%),
    radial-gradient(800px 420px at 50% 0%, rgba(255, 255, 255, 0.06), transparent 62%),
    radial-gradient(900px 520px at 50% 120%, rgba(0, 0, 0, 0.65), transparent 58%);
  mix-blend-mode: soft-light;
  opacity: 0.95;
  pointer-events: none;
}

/* Critical panel: deeper + more spec + stronger rim */
.hi-panel-critical::before {
  background:
    radial-gradient(
      900px 520px at 32% 12%,
      rgba(255, 255, 255, 0.10) 0%,
      rgba(255, 255, 255, 0.05) 18%,
      transparent 42%
    ),
    radial-gradient(
      900px 540px at 78% 22%,
      rgba(188, 188, 188, 0.07) 0%,
      rgba(188, 188, 188, 0.035) 18%,
      transparent 42%
    ),
    radial-gradient(1200px 700px at 50% 120%, rgba(0, 0, 0, 0.82), transparent 60%),
    linear-gradient(180deg, rgba(24, 34, 44, 0.68), rgba(6, 10, 14, 0.62));
}

.hi-panel-critical {
  --hi-edge-outer: rgba(255, 255, 255, 0.18);
  --hi-edge-inner: rgba(255, 255, 255, 0.09);
  --hi-spec-top-a: 0.19;
  --hi-spec-top-b: 0.08;
  box-shadow:
    0 0 0 1px var(--hi-edge-outer),
    inset 0 0 0 1px var(--hi-edge-inner),
    0 10px 22px rgba(0, 0, 0, 0.38),
    var(--hi-shadow-mid);
}

/* =========================
   OVERLAYS (attach these as child divs)
   ========================= */

.hi-inset {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow:
    var(--hi-shadow-in),
    inset 0 0 0 1px rgba(255, 255, 255, 0.04);
  background:
    linear-gradient(180deg, rgba(255, 255, 255, 0.04), transparent 45%),
    radial-gradient(140% 120% at 50% 0%, rgba(255, 255, 255, 0.05), transparent 65%);
  pointer-events: none;
}

/* Specular highlight top */
.hi-specular {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    linear-gradient(
      180deg,
      rgba(255, 255, 255, var(--hi-spec-top-a)),
      rgba(255, 255, 255, var(--hi-spec-top-b)) var(--hi-spec-stop),
      transparent var(--hi-spec-fade)
    );
  opacity: 0.85;
  mix-blend-mode: screen;
  pointer-events: none;
}

/* Rim light irregular (non-uniform edge) */
.hi-rim {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  padding: 1px;
  background:
    conic-gradient(from 210deg,
      rgba(255, 255, 255, 0.22),
      rgba(255, 255, 255, 0.06) 20%,
      rgba(201, 201, 201, 0.14) 34%,
      rgba(255, 255, 255, 0.04) 52%,
      rgba(255, 255, 255, 0.18) 78%,
      rgba(255, 255, 255, 0.06));
  /* Corte del borde tipo glass rim */
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);

  mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);

  /* Composición */
  -webkit-mask-composite: xor;
  mask-composite: exclude;

  opacity: 0.75;
  pointer-events: none;
}

/* External glow (controlled) */
.hi-glow {
  position: absolute;
  inset: -18px;
  border-radius: inherit;
  background:
    radial-gradient(
      700px 320px at 40% 10%,
      rgba(255, 255, 255, 0.10) 0%,
      rgba(255, 255, 255, 0.05) 20%,
      transparent 52%
    ),
    radial-gradient(
      600px 280px at 70% 20%,
      rgba(188, 188, 188, 0.08) 0%,
      rgba(188, 188, 188, 0.04) 20%,
      transparent 52%
    );
  filter: blur(18px);
  opacity: 0.36;
  pointer-events: none;
}

/* Grain on panel surface */
.hi-grain {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background-image: var(--hi-grain-url);
  background-size: 260px 260px;
  opacity: 0.14;
  mix-blend-mode: overlay;
  pointer-events: none;
}

/* Extra glass FX: micro glare + haze */
.hi-glassfx {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    radial-gradient(220px 140px at 78% 14%, rgba(255, 255, 255, 0.12), transparent 62%),
    radial-gradient(420px 160px at 28% 22%, rgba(255, 255, 255, 0.08), transparent 68%),
    radial-gradient(520px 200px at 76% 18%, rgba(255, 255, 255, 0.06), transparent 70%),
    linear-gradient(180deg, rgba(255, 255, 255, 0.06), transparent 50%);
  opacity: 0.85;
  mix-blend-mode: screen;
  pointer-events: none;
}

/* Glints: thin streaks, not neon. Add as overlay div */
.hi-glints {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  --hi-glint-a: 0.06;
  --hi-glint-b: 0.04;
  background:
    linear-gradient(
      115deg,
      transparent 0%,
      rgba(255, 255, 255, 0.0) 40%,
      rgba(255, 255, 255, var(--hi-glint-a)) 47%,
      rgba(255, 255, 255, 0.0) 54%,
      transparent 100%
    ),
    linear-gradient(
      102deg,
      transparent 0%,
      rgba(255, 255, 255, 0.0) 58%,
      rgba(255, 255, 255, var(--hi-glint-b)) 62%,
      rgba(255, 255, 255, 0.0) 68%,
      transparent 100%
    );
  background-size: 140% 140%, 160% 160%;
  background-position: 0% 0%, 10% -8%;
  opacity: 1;
  mix-blend-mode: screen;
  filter: blur(0.2px);
  pointer-events: none;
  animation: hi-glints-driftA 16s ease-in-out infinite;
}

.hi-glints::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    linear-gradient(
      120deg,
      transparent 0%,
      rgba(255, 255, 255, 0.0) 36%,
      rgba(255, 255, 255, var(--hi-glint-a)) 43%,
      rgba(255, 255, 255, 0.0) 49%,
      transparent 100%
    ),
    linear-gradient(
      108deg,
      transparent 0%,
      rgba(255, 255, 255, 0.0) 64%,
      rgba(255, 255, 255, var(--hi-glint-b)) 68%,
      rgba(255, 255, 255, 0.0) 74%,
      transparent 100%
    );
  background-size: 160% 160%, 180% 180%;
  background-position: -10% 6%, 8% -4%;
  mix-blend-mode: screen;
  pointer-events: none;
  animation: hi-glints-driftB 18s ease-in-out infinite;
  animation-delay: -6s;
}

.hi-panel-critical .hi-glints {
  --hi-glint-a: 0.08;
  --hi-glint-b: 0.055;
}

@keyframes hi-glints-driftA {
  0% {
    background-position: 0% 0%, 10% -8%;
  }
  50% {
    background-position: 6% -4%, 16% -2%;
  }
  100% {
    background-position: 0% 0%, 10% -8%;
  }
}

@keyframes hi-glints-driftB {
  0% {
    background-position: -10% 6%, 8% -4%;
  }
  50% {
    background-position: -2% 2%, 14% -1%;
  }
  100% {
    background-position: -10% 6%, 8% -4%;
  }
}

/* =========================
   CHART GLASS FEEL
   ========================= */

.hi-chart {
  border-radius: 14px;
  background:
    repeating-linear-gradient(
      to right,
      rgba(255, 255, 255, 0.03) 0,
      rgba(255, 255, 255, 0.03) 1px,
      transparent 1px,
      transparent 64px
    ),
    repeating-linear-gradient(
      to bottom,
      rgba(255, 255, 255, 0.02) 0,
      rgba(255, 255, 255, 0.02) 1px,
      transparent 1px,
      transparent 40px
    ),
    linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(0, 0, 0, 0.24)),
    radial-gradient(600px 260px at 60% 0%, rgba(201, 201, 201, 0.10), transparent 60%);
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.06),
    inset 0 -30px 50px rgba(0, 0, 0, 0.55);
  position: relative;
  overflow: hidden;
}

.hi-chart svg path,
.hi-chart svg line,
.hi-chart svg polyline,
.hi-chart svg circle {
  filter:
    drop-shadow(0 0 0.8px rgba(0, 0, 0, 0.55))
    drop-shadow(0 0 0.5px rgba(255, 255, 255, 0.12));
}

[data-chart-highlight="on"] {
  --hi-chart-highlight-opacity: 0.06;
  --hi-chart-highlight-period: 16s;
}

.hi-chart::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(120deg, transparent 0 40%, rgba(255, 255, 255, 0.08) 46%, transparent 52%),
    radial-gradient(500px 220px at 35% 10%, rgba(255, 255, 255, 0.08), transparent 62%);
  opacity: 0.65;
  mix-blend-mode: screen;
  pointer-events: none;
}

.hi-chart::after {
  content: "";
  position: absolute;
  inset: 0;
  background-image: var(--hi-grain-url);
  background-size: 260px 260px;
  opacity: 0.10;
  mix-blend-mode: overlay;
  pointer-events: none;
}

[data-chart-highlight="on"] .hi-chart::after {
  background-image:
    radial-gradient(1px 1px at 18% 24%, rgba(255, 255, 255, 0.12), transparent 60%),
    radial-gradient(1px 1px at 72% 18%, rgba(255, 255, 255, 0.10), transparent 60%),
    radial-gradient(1px 1px at 44% 76%, rgba(255, 255, 255, 0.08), transparent 60%),
    var(--hi-grain-url);
  background-size: 180px 180px, 240px 240px, 200px 200px, 260px 260px;
  background-position: 0 0, 24px 12px, -12px 28px, 0 0;
  opacity: 0.08;
  animation: hi-chart-sparkle 18s linear infinite;
}

@keyframes hi-chart-sparkle {
  0% {
    background-position: 0 0, 24px 12px, -12px 28px, 0 0;
  }
  50% {
    background-position: 18px -12px, 44px 22px, -28px 10px, 0 0;
  }
  100% {
    background-position: 0 0, 24px 12px, -12px 28px, 0 0;
  }
}

/* =========================
   MIRROR REFLECTION (bottom)
   ========================= */

.hi-mirror-wrap {
  position: absolute;
  inset: auto 0 -52px 0;
  height: 220px;
  pointer-events: none;
  opacity: 0.38;
  filter: blur(14px);
}

.hi-mirror {
  position: absolute;
  inset: 0;
  transform: scaleY(-1);
  transform-origin: top;
  border-radius: var(--hi-radius-xl);
  background:
    radial-gradient(900px 420px at 50% 20%, rgba(255, 255, 255, 0.08), transparent 62%),
    linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(0, 0, 0, 0.32));
  mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.55), transparent 70%);
}

/* Utility text */
.hi-dim {
  color: var(--hi-text-dim);
}


/* ===== FILE: src/components/hi/HiShaderBackground.tsx ===== */
import { useEffect, useRef } from "react"
import { Renderer, Program, Mesh, Triangle } from "ogl"

const vertex = `
attribute vec2 position;
varying vec2 vUv;
void main() {
  vUv = position * 0.5 + 0.5;
  gl_Position = vec4(position, 0.0, 1.0);
}
`

const fragment = `
precision highp float;

uniform float uTime;
uniform vec2 uResolution;
varying vec2 vUv;

float hash(vec2 p){
  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453123);
}
float noise(vec2 p){
  vec2 i = floor(p);
  vec2 f = fract(p);
  vec2 u = f * f * (3.0 - 2.0 * f);
  return mix(
    mix(hash(i + vec2(0.0,0.0)), hash(i + vec2(1.0,0.0)), u.x),
    mix(hash(i + vec2(0.0,1.0)), hash(i + vec2(1.0,1.0)), u.x),
    u.y
  );
}

void main(){
  vec2 uv = vUv;
  vec2 p = (uv - 0.5) * vec2(uResolution.x / uResolution.y, 1.0);

  float t = uTime * 0.04;

  // “campo de luz” (muy suave)
  float l1 = exp(-length(p - vec2(-0.42, 0.26 + sin(t)*0.03)) * 2.5);
  float l2 = exp(-length(p - vec2(0.48, -0.12 + cos(t)*0.02)) * 3.1);
  float l3 = exp(-length(p - vec2(0.08, -0.52)) * 2.2);

  float field = l1 + l2 * 0.9 + l3 * 0.55;

  vec3 base = vec3(0.028, 0.032, 0.045);
  vec3 steel = vec3(0.075, 0.090, 0.115);
  vec3 cyan = vec3(0.008, 0.655, 0.792); // ~ #02A7CA
  float cyanL = dot(cyan, vec3(0.299, 0.587, 0.114));

  // bloom acumulado (controlado)
  vec3 glow = vec3(cyanL) * field * 0.22;
  vec3 color = mix(base, steel, field * 0.62) + glow;

  // partículas (grano + polvo)
  float g = noise(uv * uResolution.xy * 0.33 + uTime);
  color += (g - 0.5) * 0.030;

  // vignette
  float v = smoothstep(0.98, 0.35, length(uv - 0.5));
  color *= v;

  gl_FragColor = vec4(color, 1.0);
}
`

export default function HiShaderBackground(props: { fixed?: boolean }) {
  const ref = useRef<HTMLDivElement | null>(null)

  useEffect(() => {
    const host = ref.current
    if (!host) return

    const renderer = new Renderer({
      dpr: Math.min(window.devicePixelRatio, 1.75),
      alpha: true,
    })

    const gl = renderer.gl
    host.appendChild(gl.canvas)
    gl.clearColor(0, 0, 0, 1)

    const geometry = new Triangle(gl)
    const program = new Program(gl, {
      vertex,
      fragment,
      uniforms: {
        uTime: { value: 0 },
        uResolution: { value: [1, 1] },
      },
    })
    const mesh = new Mesh(gl, { geometry, program })

    let raf = 0
    const resize = () => {
      const w = host.clientWidth || window.innerWidth
      const h = host.clientHeight || window.innerHeight
      renderer.setSize(w, h)
      program.uniforms.uResolution.value = [w, h]
    }

    const update = (t: number) => {
      raf = requestAnimationFrame(update)
      program.uniforms.uTime.value = t * 0.001
      renderer.render({ scene: mesh })
    }

    resize()
    window.addEventListener("resize", resize)
    raf = requestAnimationFrame(update)

    return () => {
      cancelAnimationFrame(raf)
      window.removeEventListener("resize", resize)
      try {
        host.removeChild(gl.canvas)
      } catch {
        void 0
      }
      gl.getExtension("WEBGL_lose_context")?.loseContext()
    }
  }, [])

  const isFixed = props.fixed === true

  return (
    <div
      ref={ref}
      className="hi-shader-bg"
      style={{
        position: isFixed ? "fixed" : "absolute",
        inset: 0,
        zIndex: 0,
        pointerEvents: "none",
      }}
    />
  )
}


/* ===== FILE: src/components/ui/button.tsx ===== */
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/shared/lib/cn"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/20 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-white text-black hover:bg-white/90",
        secondary: "bg-white/10 text-white hover:bg-white/15 border border-white/10",
        ghost: "hover:bg-white/10",
      },
      size: {
        sm: "h-9 px-3",
        md: "h-10 px-4",
        lg: "h-11 px-6",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "md",
    },
  },
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />
  },
)
Button.displayName = "Button"

export { Button, buttonVariants }


/* ===== FILE: src/index.css ===== */
@import "tailwindcss";
@import "./shared/theme/tokens.css";
@import "./shared/render/tokens/render.tokens.css";
@import "./shared/render/stage/stage.css";
@import "./shared/render/materials/materials.css";
@import "./shared/render/effects/glintSlow.css";
@import "./shared/render/effects/rimDynamic.css";
@import "./shared/render/effects/mirrorCine.css";
@import "./shared/render/effects/chartSurfaceHighlight.css";
@import "./shared/render/effects/contactOcclusion.css";
@import "./shared/render/effects/dustField.css";
@import "./app/styles/globals.css";
@import "./app/styles/hi-materials.css";


/* ===== FILE: src/main.tsx ===== */
import React from "react"
import ReactDOM from "react-dom/client"
import "@/index.css"
import { App } from "@/app/App"

declare global {
  interface Window {
    __hiQA?: {
      set: (flag: string) => void
      clear: () => void
    }
  }
}

/* [hitech] mocking bootstrap */
async function enableMocking() {
  const env = import.meta?.env ? import.meta.env : ({} as any)
  const isDev = !!env.DEV
  const flag = String(env.VITE_ENABLE_MOCKS ?? "true")
  const shouldMock = isDev && flag !== "false"
  if (!shouldMock) return

  const mod = await import("./shared/mocks/browser")
  await mod.worker.start({ onUnhandledRequest: "bypass" })
}

function registerHiQA() {
  if (!import.meta.env?.DEV) return
  void import("./shared/render/qa/qa.stage.debug.css")
  window.__hiQA = {
    set(flag: string) {
      document.documentElement.dataset.qa = flag
    },
    clear() {
      delete document.documentElement.dataset.qa
    },
  }
}

registerHiQA()
void enableMocking()

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)


/* ===== FILE: src/pages/deck/DeckPage.tsx ===== */
import { useEffect, useMemo, useState } from "react"
import { useLocation, useNavigate } from "react-router-dom"
import { DECK } from "@/shared/config/constants"
import { slideRegistry } from "@/app/deck/slideRegistry"
import { SlideNav } from "@/widgets/slide-nav/ui/SlideNav"
import { RtsDebugOverlay } from "@/rts/devtools/RtsDebugOverlay"

import { CosmicStage } from "@/shared/ui/stage/CosmicStage"
import { ScaleFrame } from "@/shared/ui/stage/ScaleFrame"
import { BoardFrame } from "@/shared/ui/stage/BoardFrame"

function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n))
}

function useQueryParam(name: string) {
  const loc = useLocation()
  return useMemo(() => new URLSearchParams(loc.search).get(name), [loc.search, name])
}

export function DeckPage() {
  const navigate = useNavigate()
  const loc = useLocation()

  const sParam = useQueryParam("s")
  const gradeParam = useQueryParam("grade")
  const grade = gradeParam === "soft" ? "soft" : "contrast"
  const total = slideRegistry.length
  const printMode = useQueryParam("print") === "1"

  const [hudOpen, setHudOpen] = useState(true)
  const [notesOpen, setNotesOpen] = useState(false)
  const [presentation, setPresentation] = useState(false)
  const [notes, setNotes] = useState("")

  const idxFromUrl = sParam ? Number(sParam) : 0
  const index = Number.isFinite(idxFromUrl) ? clamp(idxFromUrl, 0, total - 1) : 0

  // zoom safety (default 0.92 para que no se vea gigante)
  const zoomParam = useQueryParam("zoom")
  const zoomRaw = zoomParam ? Number(zoomParam) : 0.92
  const zoom = Number.isFinite(zoomRaw) ? clamp(zoomRaw, 0.75, 1) : 0.92

  const entry = slideRegistry[index]
  const Slide = entry.Component
  const notesKey = useMemo(() => `deck:notes:${entry.meta.id}`, [entry.meta.id])

  const hudVisible = hudOpen && !presentation && !printMode
  const notesVisible = notesOpen && !presentation && !printMode

  function go(nextIndex: number) {
    const safe = clamp(nextIndex, 0, total - 1)
    const qs = new URLSearchParams(loc.search)
    qs.set("s", String(safe))
    navigate({ pathname: loc.pathname, search: qs.toString() }, { replace: true })
  }

  function next() {
    go(index + 1)
  }
  function prev() {
    go(index - 1)
  }
  function first() {
    go(0)
  }
  function last() {
    go(total - 1)
  }

  function toggleParam(name: string) {
    const qs = new URLSearchParams(loc.search)
    if (qs.get(name) === "1") qs.delete(name)
    else qs.set(name, "1")
    navigate({ pathname: loc.pathname, search: qs.toString() }, { replace: true })
  }

  // Events from CMDK
  useEffect(() => {
    const onPrev = () => prev()
    const onNext = () => next()
    const onFirst = () => first()
    const onLast = () => last()

    window.addEventListener("hitech:deck:prev", onPrev)
    window.addEventListener("hitech:deck:next", onNext)
    window.addEventListener("hitech:deck:first", onFirst)
    window.addEventListener("hitech:deck:last", onLast)

    return () => {
      window.removeEventListener("hitech:deck:prev", onPrev)
      window.removeEventListener("hitech:deck:next", onNext)
      window.removeEventListener("hitech:deck:first", onFirst)
      window.removeEventListener("hitech:deck:last", onLast)
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [index, total, loc.search, loc.pathname])

  // Keyboard shortcuts
  useEffect(() => {
    function isTyping(el: EventTarget | null) {
      const t = el as HTMLElement | null
      if (!t) return false
      const tag = t.tagName?.toLowerCase()
      return tag === "input" || tag === "textarea" || tag === "select" || t.isContentEditable
    }

    function onKey(e: KeyboardEvent) {
      if (isTyping(e.target)) return
      const key = e.key.toLowerCase()

      if (e.key === "ArrowRight" || e.key === "PageDown") {
        e.preventDefault()
        next()
        return
      }
      if (e.key === "ArrowLeft" || e.key === "PageUp") {
        e.preventDefault()
        prev()
        return
      }
      if (e.key === "Home") {
        e.preventDefault()
        first()
        return
      }
      if (e.key === "End") {
        e.preventDefault()
        last()
        return
      }
      if (e.key === " " || e.code === "Space") {
        e.preventDefault()
        next()
        return
      }
      if (key === "h") {
        e.preventDefault()
        setHudOpen((v) => !v)
        return
      }
      if (key === "n") {
        e.preventDefault()
        setNotesOpen((v) => !v)
        return
      }
      if (key === "p") {
        e.preventDefault()
        setPresentation((v) => !v)
        return
      }
      if (key === "v") {
        e.preventDefault()
        toggleParam("vs")
        return
      }
      if (key === "t") {
        e.preventDefault()
        toggleParam("print")
        return
      }
    }

    window.addEventListener("keydown", onKey)
    return () => window.removeEventListener("keydown", onKey)
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [index, total, loc.search, loc.pathname])

  useEffect(() => {
    const body = document.body
    body.classList.toggle("deck-present", presentation)
    body.classList.toggle("deck-print", printMode)
    return () => {
      body.classList.remove("deck-present", "deck-print")
    }
  }, [presentation, printMode])

  useEffect(() => {
    if (typeof window === "undefined") return
    const stored = window.localStorage.getItem(notesKey)
    setNotes(stored ?? "")
  }, [notesKey])

  useEffect(() => {
    if (typeof window === "undefined") return
    window.localStorage.setItem(notesKey, notes)
  }, [notesKey, notes])

  return (
    <div className="fixed inset-0 overflow-hidden">
      {/* 1) UNIVERSO (NO escala, NO se recorta) */}
      <CosmicStage grade={grade}>
        {/* 2) SCALER (solo escala el board 1600x900) */}
        <ScaleFrame
          width={DECK.width}
          height={DECK.height}
          mode="fit"
          safety={zoom}
        >
          {/* 3) BOARD FRAME (shadow + glass plane + reflection) */}
          <BoardFrame>
            <Slide index={index} total={total} />
          </BoardFrame>
        </ScaleFrame>
      </CosmicStage>

      {/* HUD (encima del universo) */}
      <div className="pointer-events-none absolute inset-0 z-20">
        <div
          className={[
            "mx-auto w-full max-w-[1920px]",
            presentation || printMode ? "px-0 py-0" : "px-4 py-4",
          ].join(" ")}
        >
          {hudVisible ? (
            <div className="pointer-events-auto flex items-center justify-between gap-3">
              <div className="flex flex-col">
                <div className="text-sm opacity-80">Deck</div>
                <div className="text-lg font-semibold">
                  {entry.meta.title}
                  <span className="ml-2 text-sm opacity-70">
                    ({index + 1}/{total})
                  </span>
                </div>
              </div>

              <SlideNav index={index} total={total} onPrev={prev} onNext={next} />
            </div>
          ) : null}

          {hudVisible ? (
            <div className="pointer-events-auto mt-3 flex items-center justify-between text-xs opacity-75">
              <div>Shortcuts: Left/Right, PageUp/PageDown, Space, Home/End, H, N, P, V, T, Ctrl+K</div>
              <div>
                Deep link: <span className="font-mono">?s={index}</span>
              </div>
            </div>
          ) : null}
        </div>
      </div>

      {/* NOTES (encima) */}
      {notesVisible ? (
        <aside className="fixed right-6 top-24 z-50 w-[320px]">
          <div className="rounded-2xl border border-white/10 bg-black/70 p-4 shadow-[0_18px_70px_rgba(0,0,0,0.55)] backdrop-blur">
            <div className="flex items-center justify-between">
              <div className="text-xs uppercase tracking-[0.2em] opacity-70">Notes</div>
              <button
                type="button"
                className="text-xs opacity-70 hover:opacity-100"
                onClick={() => setNotesOpen(false)}
              >
                Close
              </button>
            </div>
            <div className="mt-2 text-sm opacity-80">{entry.meta.title}</div>
            <textarea
              className="mt-3 h-40 w-full resize-none rounded-xl border border-white/10 bg-black/40 p-3 text-sm text-white/90 outline-none"
              placeholder="Notes for this slide..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
            />
            <div className="mt-2 text-[11px] opacity-60">Stored locally per slide.</div>
          </div>
        </aside>
      ) : null}

      <RtsDebugOverlay />
    </div>
  )
}


/* ===== FILE: src/pages/not-found/NotFoundPage.tsx ===== */
import { Link } from "react-router-dom"

export function NotFoundPage() {
  return (
    <div className="grid min-h-svh place-items-center p-6">
      <div className="max-w-md rounded-2xl border border-white/10 bg-white/5 p-6">
        <div className="text-xl font-semibold">404</div>
        <div className="mt-2 opacity-80">Esa ruta no existe.</div>
        <Link className="mt-4 inline-block underline underline-offset-4" to="/deck">
          Ir al deck
        </Link>
      </div>
    </div>
  )
}


/* ===== FILE: src/rts/devtools/RtsDebugOverlay.tsx ===== */
// src/rts/devtools/RtsDebugOverlay.tsx
import { useEffect, useMemo, useState } from "react"
import { getHashSearchParams } from "../utils/hashQuery"

type Last = {
  spec: { id: string; archetype: string }
  results: Array<{ ruleId: string; severity: "info" | "warn" | "error"; message: string }>
  ts: number
}

function isEnabled() {
  const qs = getHashSearchParams()
  return qs.get("rts") === "1" || qs.get("vs") === "1" || qs.get("rtsDebug") === "1"
}

export function RtsDebugOverlay() {
  const [tick, setTick] = useState(0)

  useEffect(() => {
    if (!isEnabled()) return
    const id = window.setInterval(() => setTick((t) => t + 1), 600)
    return () => window.clearInterval(id)
  }, [])

  const last = useMemo(() => {
    void tick
    return (globalThis as any).__rts_vs_last as Last | undefined
  }, [tick])

  if (typeof window === "undefined") return null
  if (!isEnabled()) return null
  if (!last) return null

  const worst = last.results.some((r) => r.severity === "error")
    ? "error"
    : last.results.some((r) => r.severity === "warn")
      ? "warn"
      : "info"

  return (
    <div
      style={{
        position: "fixed",
        right: 12,
        bottom: 12,
        width: 420,
        zIndex: 50_000,
        padding: 12,
        borderRadius: 16,
        border: "1px solid rgba(255,255,255,0.12)",
        background: "rgba(0,0,0,0.65)",
        backdropFilter: "blur(10px)",
        color: "rgba(255,255,255,0.92)",
        fontFamily: "ui-sans-serif, system-ui",
      }}
    >
      <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between", gap: 12 }}>
        <div style={{ fontWeight: 700, fontSize: 13 }}>
          VS Debug <span style={{ opacity: 0.75 }}>({worst})</span>
        </div>
        <div style={{ opacity: 0.65, fontSize: 12 }}>
          {last.spec.id} · {last.spec.archetype}
        </div>
      </div>

      <div style={{ marginTop: 10, display: "grid", gap: 8, maxHeight: 260, overflow: "auto" }}>
        {last.results.length ? (
          last.results.map((r, i) => (
            <div key={i} style={{ padding: 10, borderRadius: 12, background: "rgba(255,255,255,0.07)" }}>
              <div style={{ display: "flex", justifyContent: "space-between", gap: 10 }}>
                <div style={{ fontWeight: 700, fontSize: 12 }}>
                  {r.severity.toUpperCase()} · {r.ruleId}
                </div>
                <div style={{ opacity: 0.7, fontSize: 12 }}>VS</div>
              </div>
              <div style={{ marginTop: 6, opacity: 0.9, fontSize: 12, lineHeight: 1.35 }}>{r.message}</div>
            </div>
          ))
        ) : (
          <div style={{ opacity: 0.85, fontSize: 12 }}>Sin warnings. Todo chulo ✅</div>
        )}
      </div>

      <div style={{ marginTop: 10, opacity: 0.65, fontSize: 11 }}>
        Tip: agrega <span style={{ fontFamily: "ui-monospace, SFMono-Regular, Menlo, monospace" }}>?vs=1</span> al hash.
      </div>
    </div>
  )
}


/* ===== FILE: src/rts/foundation/smartservices_types.ts ===== */
// src/rts/foundation/smartservices_types.ts
// SmartServices vocabulary (Block 3 only)
// Strategic Canon ID: HITECH_RTS_EXEC_CANON_V1

export type EvidenceState = "verified" | "pending" | "blocked";

export const EvidenceStateLabel: Record<EvidenceState, string> = {
  verified: "Verified",
  pending: "Pending",
  blocked: "Blocked",
};

export type HealthBand = "stable" | "watch" | "alert" | "critical";

export const HealthBandLabel: Record<HealthBand, string> = {
  stable: "Stable",
  watch: "Watch",
  alert: "Alert",
  critical: "Critical",
};

export type CanonState = "Stable" | "Watch" | "Alert" | "Critical" | "Pending" | "Blocked";

export type RiskCategory =
  | "continuity"
  | "operations"
  | "compliance"
  | "safety"
  | "procurement"
  | "traceability";

export const RiskCategoryLabel: Record<RiskCategory, string> = {
  continuity: "Continuity",
  operations: "Operations",
  compliance: "Compliance",
  safety: "Safety",
  procurement: "Procurement",
  traceability: "Traceability",
};

export type DecisionOutput = {
  owner: string;
  nextAction: string;
};

export type DecisionOption = {
  id: string;
  label: string;
  tradeoffs?: string;
  evidenceRef?: string;
};

export type DecisionRecord = {
  id: string;
  question: string;
  state: CanonState;
  owner: string;
  sourceRef?: string;
  verificationRef?: string;
  options: DecisionOption[];
  recommendation?: string;
  nextAction?: string;
};

export type EvidenceArtifact = {
  id: string;
  label: string;
  state: CanonState;
  owner: string;
  summary?: string;
  sourceRef?: string;
  verificationRef?: string;
};

export type EvidenceRecord = {
  id: string;
  title: string;
  state: EvidenceState;
  custody: string;
  anchor: string;
  interpretation: string;
  decision: DecisionOutput;
};

export type RiskItem = {
  id: string;
  label: string;
  state: CanonState;
  owner: string;
  probability?: string;
  impact?: string;
  mitigation?: string;
  evidenceRef?: string;
};

export type RiskRecord = {
  id: string;
  category: RiskCategory;
  title: string;
  band: HealthBand;
  posture: string;
  requiredEvidence: Array<Pick<EvidenceRecord, "id" | "title" | "state" | "anchor">>;
  decision: DecisionOutput;
};

export type KaizenA3 = {
  id: string;
  title: string;
  state: CanonState;
  owner: string;
  sourceRef?: string;
  verificationRef?: string;
  problemStatement: string;
  containment?: string;
  rootCause?: string;
  countermeasure?: string;
  nextAction?: string;
};


/* ===== FILE: src/rts/slides/templates/ComparisonTemplate.tsx ===== */
// src/rts/slides/templates/ComparisonTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame"
import { ExecutiveHeader } from "../../ui/ExecutiveHeader"
import { Panel } from "../../ui/Panel"
import { Text } from "../../ui/Text"
import { logConsistency } from "../../system/consistency_enforcer"

export const slideSpec = {
  id: "TEMPLATE_COMPARISON",
  archetype: "Comparison Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  sectionCount: 2,
}

export function ComparisonTemplate(props: {
  title: string
  breadcrumb?: string
  slideNum?: number
  leftTitle: string
  left: string[]
  rightTitle: string
  right: string[]
}) {
  logConsistency({ ...slideSpec, bulletCount: props.left.length + props.right.length })

  return (
    <SlideFrame>
      <ExecutiveHeader title={props.title} breadcrumb={props.breadcrumb} slideNum={props.slideNum} />
      <SlideGrid className="mt-3">
        <div className="col-span-6">
          <Panel title={props.leftTitle}>
            <div style={{ display: "grid", gap: 10 }}>
              {props.left.slice(0, 7).map((t, i) => (
                <div key={i} style={{ padding: 10, borderRadius: 14, background: "rgba(255,255,255,0.06)" }}>
                  <Text variant="body">{t}</Text>
                </div>
              ))}
            </div>
          </Panel>
        </div>
        <div className="col-span-6">
          <Panel title={props.rightTitle}>
            <div style={{ display: "grid", gap: 10 }}>
              {props.right.slice(0, 7).map((t, i) => (
                <div key={i} style={{ padding: 10, borderRadius: 14, background: "rgba(255,255,255,0.06)" }}>
                  <Text variant="body">{t}</Text>
                </div>
              ))}
            </div>
          </Panel>
        </div>
      </SlideGrid>
    </SlideFrame>
  )
}


/* ===== FILE: src/rts/slides/templates/DecisionGateTemplate.tsx ===== */
// src/slides/templates/DecisionGateTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame";
import { ExecutiveHeader } from "../../ui/ExecutiveHeader";
import { Text } from "../../ui/Text";
import { DecisionCard } from "../../ui/DecisionCard";
import type { DecisionRecord } from "../../foundation/smartservices_types";
import { logConsistency } from "../../system/consistency_enforcer";

export const slideSpec = {
  id: "TEMPLATE_DECISION_GATE",
  archetype: "Decision Gate Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: ["Non-flagship template.", "Decision must follow evidence and interpretation."],
};

const sample: DecisionRecord = {
  id: "DEC-001",
  question: "Approve governance path for evidence validation before executive presentation export?",
  state: "Pending",
  owner: "Owner: Pending",
  sourceRef: "Unavailable",
  verificationRef: "Pending",
  options: [
    {
      id: "OPT-A",
      label: "Option A: minimal validation path (fast, higher uncertainty)",
      tradeoffs: "Tradeoff: lower confidence without clear verification record.",
      evidenceRef: "Pending",
    },
    {
      id: "OPT-B",
      label: "Option B: audited validation path (slower, higher confidence)",
      tradeoffs: "Tradeoff: requires ownership and trace references to exist.",
      evidenceRef: "Pending",
    },
  ],
  recommendation: "Pending",
  nextAction: "Next action: assign owner + confirm validation artifact format.",
};

export function DecisionGateTemplate(props: {
  title?: string;
  breadcrumb?: string;
  slideNum?: string;
  record?: DecisionRecord;
  footer?: string;
}) {
  const {
    title = "Decision Gate (Foundation)",
    breadcrumb = "Block 2 • Template",
    slideNum = "T-DEC",
    record = sample,
    footer = "If decision cannot be supported with traceable evidence, it remains Pending or Blocked.",
  } = props;

  logConsistency(slideSpec);

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />

      <div style={{ marginTop: 28 }}>
        <SlideGrid>
          <div style={{ gridColumn: "span 12" }}>
            <DecisionCard record={record} />
          </div>
        </SlideGrid>

        <div style={{ marginTop: 18 }}>
          <Text variant="micro">{footer}</Text>
        </div>
      </div>
    </SlideFrame>
  );
}

export default DecisionGateTemplate;


/* ===== FILE: src/rts/slides/templates/EvidenceSummaryTemplate.tsx ===== */
// src/slides/templates/EvidenceSummaryTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame";
import { ExecutiveHeader } from "../../ui/ExecutiveHeader";
import { Panel } from "../../ui/Panel";
import { Stack } from "../../ui/Stack";
import { Text } from "../../ui/Text";
import { logConsistency } from "../../system/consistency_enforcer";

export const slideSpec = {
  id: "TEMPLATE_EVIDENCE_SUMMARY",
  archetype: "Evidence Summary Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: ["Non-flagship template. Hard limit: 3 evidence cards above fold."],
};

type EvidenceCard = {
  label: string;
  description: string;
  artifacts: string[];
};

type Props = {
  title?: string;
  breadcrumb?: string;
  slideNum?: number;
  cards?: EvidenceCard[];
  footer?: string;
};

export function EvidenceSummaryTemplate(props: Props) {
  logConsistency(slideSpec);

  const {
    title = "EVIDENCE, NOT PROMISES",
    breadcrumb = "VAULT",
    slideNum,
    cards = [
      { label: "Work Orders", description: "Execution trails and approvals.", artifacts: ["PO / WO", "Sign-off", "Scope revisions"] },
      { label: "Technical Logs", description: "Traceable diagnostics and actions.", artifacts: ["Bitácoras", "Fotos", "Checklists"] },
      { label: "Preventive Control", description: "Risk-driven prevention cycles.", artifacts: ["Plans", "Procedures", "Change history"] },
    ],
    footer = "Vault stores auditable artifacts: one place, traceable, reviewable.",
  } = props;

  const safeCards = cards.slice(0, 3);

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />

      <div style={{ marginTop: 28 }}>
        <SlideGrid>
          {safeCards.map((c, idx) => (
            <div key={idx} style={{ gridColumn: "span 4" }}>
              <Panel className="p-6 h-full">
                <Stack gap={12}>
                  <Text variant="kicker" className="vs-accent-cyan">
                    {c.label}
                  </Text>
                  <Text variant="h2">{c.description}</Text>

                  <div className="vs-panel--soft" style={{ padding: 14, borderRadius: "var(--vs-r-2)" }}>
                    <Text variant="micro" style={{ letterSpacing: "0.22em" }}>
                      ARTIFACTS
                    </Text>
                    <ul style={{ marginTop: 10, color: "var(--vs-fg-1)" }}>
                      {c.artifacts.slice(0, 4).map((a, i) => (
                        <li key={i} style={{ marginBottom: 6 }}>
                          <Text as="span" variant="body" style={{ fontSize: 17 }}>
                            {a}
                          </Text>
                        </li>
                      ))}
                    </ul>
                  </div>
                </Stack>
              </Panel>
            </div>
          ))}
        </SlideGrid>

        <div style={{ marginTop: 18 }}>
          <Text variant="micro">{footer}</Text>
        </div>
      </div>
    </SlideFrame>
  );
}

export default EvidenceSummaryTemplate;


/* ===== FILE: src/rts/slides/templates/ExecutiveNarrativeTemplate.tsx ===== */
// src/slides/templates/ExecutiveNarrativeTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame";
import { ExecutiveHeader } from "../../ui/ExecutiveHeader";
import { ExecutiveNav } from "../../ui/ExecutiveNav";
import { Panel } from "../../ui/Panel";
import { Stack } from "../../ui/Stack";
import { Text } from "../../ui/Text";
import { logConsistency } from "../../system/consistency_enforcer";

export const slideSpec = {
  id: "TEMPLATE_EXEC_NARRATIVE",
  archetype: "Executive Narrative Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: ["Non-flagship template. Strict density limits: title + <=3 bullets + <=1 callout."],
};

type Props = {
  title?: string;
  breadcrumb?: string;
  slideNum?: number;
  bullets?: string[];
  calloutTitle?: string;
  calloutBody?: string;
  prev?: () => void;
  next?: () => void;
};

export function ExecutiveNarrativeTemplate(props: Props) {
  logConsistency(slideSpec);

  const {
    title = "SYSTEM, NOT SERVICE",
    breadcrumb = "SYSTEM_BOOT",
    slideNum,
    bullets = [
      "Install operational control (process + traceability).",
      "Convert knowledge into documented evidence.",
      "Shift decisions to risk (Probability × Impact).",
    ],
    calloutTitle = "CEO Rule",
    calloutBody = "If it doesn’t improve Control, Evidence, Prevention, or Decision, it does not ship.",
    prev,
    next,
  } = props;

  const safeBullets = bullets.slice(0, 3);

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />

      <div style={{ marginTop: 28 }}>
        <SlideGrid>
          <div style={{ gridColumn: "1 / span 7" }}>
            <Stack gap={16}>
              <Text variant="h2">What changes immediately</Text>

              <Panel className="p-6">
                <ul className="list-disc pl-6" style={{ color: "var(--vs-fg-1)" }}>
                  {safeBullets.map((b, i) => (
                    <li key={i} style={{ marginBottom: 12 }}>
                      <Text as="span" variant="body">
                        {b}
                      </Text>
                    </li>
                  ))}
                </ul>
              </Panel>

              <Text variant="micro" style={{ opacity: 0.9 }}>
                Interactivity is optional: exploration reinforces trust, never replaces narrative.
              </Text>
            </Stack>
          </div>

          <div style={{ gridColumn: "8 / span 5" }}>
            <Panel variant="soft" className="p-6">
              <Stack gap={12}>
                <Text variant="kicker">{calloutTitle}</Text>
                <Text variant="body">{calloutBody}</Text>

                <div className="vs-panel--soft" style={{ padding: 14, borderRadius: "var(--vs-r-2)" }}>
                  <Text variant="micro" style={{ letterSpacing: "0.22em" }}>
                    Transnational • Tier-grade • Evidence-first
                  </Text>
                </div>
              </Stack>
            </Panel>
          </div>
        </SlideGrid>
      </div>

      {(prev || next) ? <ExecutiveNav prev={prev} next={next} /> : null}
    </SlideFrame>
  );
}

export default ExecutiveNarrativeTemplate;


/* ===== FILE: src/rts/slides/templates/index.ts ===== */
// src/rts/slides/templates/index.ts
export { ExecutiveNarrativeTemplate } from "./ExecutiveNarrativeTemplate"
export { EvidenceSummaryTemplate } from "./EvidenceSummaryTemplate"
export { SystemOverviewStaticTemplate } from "./SystemOverviewStaticTemplate"
export { DecisionGateTemplate } from "./DecisionGateTemplate"
export { RiskRegisterTemplate } from "./RiskRegisterTemplate"
export { KaizenA3Template } from "./KaizenA3Template"

export { KpiGridTemplate } from "./KpiGridTemplate"
export { TimelineTemplate } from "./TimelineTemplate"
export { ProblemSolutionTemplate } from "./ProblemSolutionTemplate"
export { ComparisonTemplate } from "./ComparisonTemplate"


/* ===== FILE: src/rts/slides/templates/KaizenA3Template.tsx ===== */
// src/slides/templates/KaizenA3Template.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame";
import { ExecutiveHeader } from "../../ui/ExecutiveHeader";
import { Panel } from "../../ui/Panel";
import { Stack } from "../../ui/Stack";
import { Text } from "../../ui/Text";
import type { KaizenA3 } from "../../foundation/smartservices_types";
import { StatusPill } from "../../ui/StatusPill";
import { logConsistency } from "../../system/consistency_enforcer";

export const slideSpec = {
  id: "TEMPLATE_KAIZEN_A3",
  archetype: "Kaizen A3 Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: ["Non-flagship template.", "A3 structure only. No performance claims."],
};

const sample: KaizenA3 = {
  id: "KZN-001",
  title: "Standardize evidence language to prevent executive drift",
  state: "Watch",
  owner: "Owner: Pending",
  sourceRef: "Pending",
  verificationRef: "Pending",
  problemStatement: "Multiple terms describe the same concept, creating ambiguity at audit and board level.",
  containment: "Freeze new label creation in slides until vocabulary is locked.",
  rootCause: "No controlled vocabulary boundary enforced at template level.",
  countermeasure: "Embed slot-based labels (Evidence/Risk/Decision) into primitives and templates.",
  nextAction: "Next action: adopt vocabulary lock; run consistency scan across templates.",
};

export function KaizenA3Template(props: {
  title?: string;
  breadcrumb?: string;
  slideNum?: string;
  a3?: KaizenA3;
  footer?: string;
}) {
  const {
    title = "Kaizen A3 (Foundation)",
    breadcrumb = "Block 2 • Template",
    slideNum = "T-KZN",
    a3 = sample,
    footer = "Kaizen is documented improvement logic. Claims require trace references.",
  } = props;

  logConsistency(slideSpec);

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />

      <div style={{ marginTop: 28 }}>
        <Panel variant="soft" className="p-5">
          <div style={{ display: "flex", justifyContent: "space-between", gap: 10 }}>
            <Text variant="h2">{a3.title}</Text>
            <StatusPill state={a3.state} />
          </div>
          <Text variant="micro" style={{ marginTop: 10 }}>
            <span className="vs-fg-2">Owner:</span> {a3.owner} •{" "}
            <span className="vs-fg-2">Trace:</span> {a3.id}
          </Text>
        </Panel>

        <div style={{ marginTop: 18 }}>
          <SlideGrid>
            <div style={{ gridColumn: "span 6" }}>
              <Panel className="p-4">
                <Stack gap={8}>
                  <Text variant="kicker">Problem statement</Text>
                  <Text variant="body">{a3.problemStatement}</Text>
                </Stack>
              </Panel>
            </div>

            <div style={{ gridColumn: "span 6" }}>
              <Panel className="p-4">
                <Stack gap={8}>
                  <Text variant="kicker">Containment</Text>
                  <Text variant="body">{a3.containment ?? "Pending"}</Text>
                </Stack>
              </Panel>
            </div>

            <div style={{ gridColumn: "span 6" }}>
              <Panel className="p-4">
                <Stack gap={8}>
                  <Text variant="kicker">Root cause</Text>
                  <Text variant="body">{a3.rootCause ?? "Pending"}</Text>
                </Stack>
              </Panel>
            </div>

            <div style={{ gridColumn: "span 6" }}>
              <Panel className="p-4">
                <Stack gap={8}>
                  <Text variant="kicker">Countermeasure</Text>
                  <Text variant="body">{a3.countermeasure ?? "Pending"}</Text>
                </Stack>
              </Panel>
            </div>

            <div style={{ gridColumn: "span 12" }}>
              <Panel variant="soft" className="p-4">
                <Stack gap={8}>
                  <Text variant="kicker">Next action</Text>
                  <Text variant="body">{a3.nextAction ?? "Pending"}</Text>
                  <Text variant="micro">
                    <span className="vs-fg-2">Source:</span> {a3.sourceRef ?? "Unavailable"} •{" "}
                    <span className="vs-fg-2">Verification:</span> {a3.verificationRef ?? "Pending"}
                  </Text>
                </Stack>
              </Panel>
            </div>
          </SlideGrid>
        </div>

        <div style={{ marginTop: 18 }}>
          <Text variant="micro">{footer}</Text>
        </div>
      </div>
    </SlideFrame>
  );
}

export default KaizenA3Template;


/* ===== FILE: src/rts/slides/templates/KpiGridTemplate.tsx ===== */
// src/rts/slides/templates/KpiGridTemplate.tsx
import React from "react"
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame"
import { ExecutiveHeader } from "../../ui/ExecutiveHeader"
import { Panel } from "../../ui/Panel"
import { Stack } from "../../ui/Stack"
import { KpiCard } from "../../ui/KpiCard"
import { logConsistency } from "../../system/consistency_enforcer"

export const slideSpec = {
  id: "TEMPLATE_KPI_GRID",
  archetype: "KPI Grid Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: ["Placeholders only: avoid real numbers until approved."],
  sectionCount: 2,
}

export function KpiGridTemplate(props: {
  title: string
  breadcrumb?: string
  slideNum?: number
  kpis: Array<{ label: string; value: string; hint?: string; state?: "stable" | "watch" | "alert" | "critical" | "muted" }>
  left?: React.ReactNode
}) {
  logConsistency({ ...slideSpec, bulletCount: 0 })

  const { title, breadcrumb = "HITECH", slideNum, kpis, left } = props

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />
      <SlideGrid className="mt-3">
        <div className="col-span-5">
          <Panel title="Contexto" rightBadge="Executive">
            <Stack gap={10}>
              {left ?? (
                <div style={{ opacity: 0.85, lineHeight: 1.35 }}>
                  Usa este bloque para el resumen. Si necesitas datos, mete la fuente en notas.
                </div>
              )}
            </Stack>
          </Panel>
        </div>

        <div className="col-span-7">
          <Panel title="Indicadores (placeholder)">
            <div style={{ display: "grid", gridTemplateColumns: "repeat(2, minmax(0, 1fr))", gap: 12 }}>
              {kpis.map((k, i) => (
                <KpiCard key={i} label={k.label} value={k.value} hint={k.hint} state={k.state} />
              ))}
            </div>
          </Panel>
        </div>
      </SlideGrid>
    </SlideFrame>
  )
}


/* ===== FILE: src/rts/slides/templates/ProblemSolutionTemplate.tsx ===== */
// src/rts/slides/templates/ProblemSolutionTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame"
import { ExecutiveHeader } from "../../ui/ExecutiveHeader"
import { Panel } from "../../ui/Panel"
import { Text } from "../../ui/Text"
import { Callout } from "../../ui/Callout"
import { logConsistency } from "../../system/consistency_enforcer"

export const slideSpec = {
  id: "TEMPLATE_PROBLEM_SOLUTION",
  archetype: "Problem/Solution Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  sectionCount: 2,
}

export function ProblemSolutionTemplate(props: {
  title: string
  breadcrumb?: string
  slideNum?: number
  problem: string
  solution: string
  risks?: string[]
}) {
  logConsistency({ ...slideSpec, bulletCount: (props.risks ?? []).length })

  return (
    <SlideFrame>
      <ExecutiveHeader title={props.title} breadcrumb={props.breadcrumb} slideNum={props.slideNum} />
      <SlideGrid className="mt-3">
        <div className="col-span-6">
          <Panel title="Problema">
            <Text variant="body">{props.problem}</Text>
            <div style={{ marginTop: 12 }}>
              <Callout title="Qué se rompe si no actuamos" body="Credibilidad, foco y velocidad de ejecución." tone="warn" />
            </div>
          </Panel>
        </div>
        <div className="col-span-6">
          <Panel title="Solución">
            <Text variant="body">{props.solution}</Text>
            {props.risks?.length ? (
              <div style={{ marginTop: 12 }}>
                <Text variant="micro" className="vs-muted">
                  Riesgos
                </Text>
                <div style={{ marginTop: 8, display: "grid", gap: 8 }}>
                  {props.risks.slice(0, 6).map((r, i) => (
                    <div key={i} style={{ padding: 10, borderRadius: 14, background: "rgba(255,255,255,0.06)", border: "1px solid rgba(255,255,255,0.10)" }}>
                      <Text variant="body">{r}</Text>
                    </div>
                  ))}
                </div>
              </div>
            ) : null}
          </Panel>
        </div>
      </SlideGrid>
    </SlideFrame>
  )
}


/* ===== FILE: src/rts/slides/templates/RiskRegisterTemplate.tsx ===== */
// src/slides/templates/RiskRegisterTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame";
import { ExecutiveHeader } from "../../ui/ExecutiveHeader";
import { Panel } from "../../ui/Panel";
import { Stack } from "../../ui/Stack";
import { Text } from "../../ui/Text";
import { RiskCard } from "../../ui/RiskCard";
import type { RiskItem } from "../../foundation/smartservices_types";
import { logConsistency } from "../../system/consistency_enforcer";

export const slideSpec = {
  id: "TEMPLATE_RISK_REGISTER",
  archetype: "Risk Register Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: [
    "Non-flagship template.",
    "Hard limit: 4 risks above fold.",
    "No numeric scoring; categorical bands only.",
  ],
};

const sample: RiskItem[] = [
  {
    id: "RISK-001",
    label: "Traceability gap in incoming evidence for a critical claim",
    state: "Watch",
    owner: "Owner: Pending",
    probability: "Medium",
    impact: "High",
    mitigation: "Next action: define evidence owner + verification path",
    evidenceRef: "Pending",
  },
  {
    id: "RISK-002",
    label: "Decision ambiguity due to mixed vocabulary across teams",
    state: "Alert",
    owner: "Owner: Pending",
    probability: "High",
    impact: "Medium",
    mitigation: "Next action: enforce controlled labels (Evidence/Risk/Decision)",
    evidenceRef: "Unavailable",
  },
  {
    id: "RISK-003",
    label: "Visual drift creates authority regression during board review",
    state: "Watch",
    owner: "Owner: Pending",
    probability: "Medium",
    impact: "Medium",
    mitigation: "Next action: run visual regression guardrails before export",
    evidenceRef: "Pending",
  },
];

export function RiskRegisterTemplate(props: {
  title?: string;
  breadcrumb?: string;
  slideNum?: string;
  intro?: string;
  risks?: RiskItem[];
  footer?: string;
}) {
  const {
    title = "Risk Register (Foundation)",
    breadcrumb = "Block 2 • Template",
    slideNum = "T-RISK",
    intro = "Risk exists to enable prevention. This template frames risk categorically and binds it to ownership and next action.",
    risks = sample,
    footer = "Foundation template. Populate only with traceable items. If an item has no source, it must be Unavailable.",
  } = props;

  logConsistency(slideSpec);

  const shown = risks.slice(0, 4);

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />

      <div style={{ marginTop: 28 }}>
        <Panel variant="soft" className="p-5">
          <Stack gap={10}>
            <Text variant="kicker">Interpretation frame</Text>
            <Text variant="body">{intro}</Text>
          </Stack>
        </Panel>

        <div style={{ marginTop: 22 }}>
          <SlideGrid>
            {shown.map((r) => (
              <div key={r.id} style={{ gridColumn: "span 6" }}>
                <RiskCard item={r} />
              </div>
            ))}
          </SlideGrid>
        </div>

        <div style={{ marginTop: 18 }}>
          <Text variant="micro">{footer}</Text>
        </div>
      </div>
    </SlideFrame>
  );
}

export default RiskRegisterTemplate;


/* ===== FILE: src/rts/slides/templates/SystemOverviewStaticTemplate.tsx ===== */
// src/slides/templates/SystemOverviewStaticTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame";
import { ExecutiveHeader } from "../../ui/ExecutiveHeader";
import { Panel } from "../../ui/Panel";
import { Stack } from "../../ui/Stack";
import { Text } from "../../ui/Text";
import { logConsistency } from "../../system/consistency_enforcer";

export const slideSpec = {
  id: "TEMPLATE_SYSTEM_OVERVIEW_STATIC",
  archetype: "System Overview (Static) Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  notes: ["Non-flagship template. Hard limit: 3 columns + 1 risk banner. No charts."],
};

type Props = {
  title?: string;
  breadcrumb?: string;
  slideNum?: number;
};

export function SystemOverviewStaticTemplate(props: Props) {
  logConsistency(slideSpec);

  const { title = "THE SYSTEM MODEL", breadcrumb = "HITECH_CORE", slideNum } = props;

  return (
    <SlideFrame>
      <ExecutiveHeader title={title} breadcrumb={breadcrumb} slideNum={slideNum} />

      <div style={{ marginTop: 28 }}>
        <Panel variant="soft" className="p-5">
          <Text variant="kicker">Decision frame</Text>
          <Text variant="body">
            Prevention is prioritized by <span className="vs-accent-gold">Risk</span> (Probability × Impact). No single-person rescue narratives, only governance.
          </Text>
        </Panel>

        <div style={{ marginTop: 22 }}>
          <SlideGrid>
            <div style={{ gridColumn: "span 4" }}>
              <Panel className="p-6 h-full">
                <Stack gap={12}>
                  <Text variant="kicker">Inputs</Text>
                  <Text variant="h2">Data + History</Text>
                  <Text variant="body">
                    Work orders, logs, evidence artifacts, and operational context. Nothing depends on memory.
                  </Text>
                </Stack>
              </Panel>
            </div>

            <div style={{ gridColumn: "span 4" }}>
              <Panel className="p-6 h-full">
                <Stack gap={12}>
                  <Text variant="kicker" className="vs-accent-cyan">
                    Core
                  </Text>
                  <Text variant="h2">Control Model</Text>
                  <Text variant="body">
                    Processes + traceability produce auditable evidence, enabling consistent operation and scalable governance.
                  </Text>
                </Stack>
              </Panel>
            </div>

            <div style={{ gridColumn: "span 4" }}>
              <Panel className="p-6 h-full">
                <Stack gap={12}>
                  <Text variant="kicker">Outputs</Text>
                  <Text variant="h2">Prevention + Decision</Text>
                  <Text variant="body">
                    Risk-driven prevention cycles, clear prioritization, and evidence-backed decisions.
                  </Text>
                </Stack>
              </Panel>
            </div>
          </SlideGrid>
        </div>

        <div style={{ marginTop: 18 }}>
          <Text variant="micro">
            Interactivity may reveal deeper evidence trails, but the system remains understandable in one pass.
          </Text>
        </div>
      </div>
    </SlideFrame>
  );
}

export default SystemOverviewStaticTemplate;


/* ===== FILE: src/rts/slides/templates/TimelineTemplate.tsx ===== */
// src/rts/slides/templates/TimelineTemplate.tsx
import { SlideFrame, SlideGrid } from "../../ui/SlideFrame"
import { ExecutiveHeader } from "../../ui/ExecutiveHeader"
import { Panel } from "../../ui/Panel"
import { Text } from "../../ui/Text"
import { logConsistency } from "../../system/consistency_enforcer"

export const slideSpec = {
  id: "TEMPLATE_TIMELINE",
  archetype: "Timeline Template",
  usesVisualSystem: true,
  usesNumericKpis: false,
  sectionCount: 1,
}

export function TimelineTemplate(props: {
  title: string
  breadcrumb?: string
  slideNum?: number
  items: Array<{ when: string; what: string; owner?: string }>
}) {
  logConsistency({ ...slideSpec, bulletCount: props.items.length, hasDates: true, notes: ["As-of: CDMX"] })

  return (
    <SlideFrame>
      <ExecutiveHeader title={props.title} breadcrumb={props.breadcrumb} slideNum={props.slideNum} />
      <SlideGrid className="mt-3">
        <div className="col-span-12">
          <Panel title="Timeline">
            <div style={{ display: "grid", gap: 10 }}>
              {props.items.map((it, i) => (
                <div key={i} style={{ display: "grid", gridTemplateColumns: "160px 1fr 160px", gap: 12, alignItems: "baseline" }}>
                  <Text variant="micro" className="vs-muted">
                    {it.when}
                  </Text>
                  <Text variant="body">{it.what}</Text>
                  <Text variant="micro" className="vs-muted" style={{ textAlign: "right" }}>
                    {it.owner ?? ""}
                  </Text>
                </div>
              ))}
            </div>
          </Panel>
        </div>
      </SlideGrid>
    </SlideFrame>
  )
}


/* ===== FILE: src/rts/system/consistency_enforcer.ts ===== */
// src/system/consistency_enforcer.ts
import { RULES, RuleResult, SlideSpec } from "./consistency_rules";

export function runConsistencyEnforcer(spec: SlideSpec): RuleResult[] {
  const results: RuleResult[] = [];
  for (const r of RULES) {
    const hit = r.check(spec);
    if (hit) results.push(hit);
  }
  return results;
}

/**
 * Dev-only helper: log consistency results in console.
 * Future blocks can elevate this into UI overlays and CI checks.
 */
export function logConsistency(
  spec: SlideSpec,
  opts?: { force?: boolean; quiet?: boolean; capture?: boolean }
): RuleResult[] {
  const isDev = typeof import.meta !== "undefined" && (import.meta as any).env ? (import.meta as any).env.DEV : false
  if (!isDev && !opts?.force) return []

  const res = runConsistencyEnforcer(spec)

  // Capture last results for debug overlays
  if (opts?.capture !== false) {
    ;(globalThis as any).__rts_vs_last = { spec, results: res, ts: Date.now() }
  }

  if (opts?.quiet || !res.length) return res

  // Group output for fast debugging without polluting production
   
  console.groupCollapsed("[VS] Consistency warnings for " + spec.id + " (" + spec.archetype + ")")
  for (const r of res) {
    const tag = r.severity.toUpperCase()
     
    console.log(tag + " " + r.ruleId + ": " + r.message)
  }
   
  console.groupEnd()

  return res
}


/* ===== FILE: src/rts/system/consistency_rules.ts ===== */
// src/system/consistency_rules.ts
// Visual Consistency Rules (Foundation)
// NOTE: This is a baseline registry; enforcement is expanded in future blocks.

export type Severity = "info" | "warn" | "error";

export type SlideSpec = {
  id: string;
  archetype: string;
  usesVisualSystem?: boolean;
  usesNumericKpis?: boolean; // must be false in canon
  notes?: string[];
  bulletCount?: number;
  sectionCount?: number;
  hasCharts?: boolean;
  hasTables?: boolean;
  hasDates?: boolean;
};

export type RuleResult = { ruleId: string; severity: Severity; message: string };

export type Rule = {
  id: string;
  severity: Severity;
  description: string;
  check: (spec: SlideSpec) => RuleResult | null;
};

export const RULES: Rule[] = [
  {
    id: "VS_REQUIRED",
    severity: "warn",
    description: "Slide should declare it uses the Visual System (tokens + primitives).",
    check: (spec) =>
      spec.usesVisualSystem ? null : { ruleId: "VS_REQUIRED", severity: "warn", message: "Slide does not declare usesVisualSystem=true." },
  },
  {
    id: "NO_NUMERIC_KPIS",
    severity: "error",
    description: "Numeric KPI values are forbidden in this phase/canon.",
    check: (spec) =>
      spec.usesNumericKpis ? { ruleId: "NO_NUMERIC_KPIS", severity: "error", message: "usesNumericKpis=true is forbidden." } : null,
  },

  {
    id: "MAX_BULLETS",
    severity: "warn",
    description: "Keep bullets under control (default 7).",
    check: (spec) =>
      typeof spec.bulletCount === "number" && spec.bulletCount > 7
        ? { ruleId: "MAX_BULLETS", severity: "warn", message: "bulletCount=" + spec.bulletCount + " (recommended ≤ 7)." }
        : null,
  },
  {
    id: "SECTION_SANITY",
    severity: "info",
    description: "Too many sections tends to fragment executive scanning.",
    check: (spec) =>
      typeof spec.sectionCount === "number" && spec.sectionCount > 4
        ? { ruleId: "SECTION_SANITY", severity: "info", message: "sectionCount=" + spec.sectionCount + " (recommended ≤ 4)." }
        : null,
  },
  {
    id: "CHART_DISCLOSURE",
    severity: "warn",
    description: "If a slide has charts/tables, include a source note.",
    check: (spec) => {
      const needs = !!(spec.hasCharts || spec.hasTables)
      if (!needs) return null
      const notes = spec.notes ?? []
      const hasSource = notes.some((n) => /source|fuente|data/i.test(n))
      return hasSource
        ? null
        : { ruleId: "CHART_DISCLOSURE", severity: "warn", message: "Charts/Tables present but no data source note found." }
    },
  },
  {
    id: "DATES_NEED_CONTEXT",
    severity: "info",
    description: "If a slide references dates, add context in notes (timezone, as-of).",
    check: (spec) => {
      if (!spec.hasDates) return null
      const notes = spec.notes ?? []
      const ok = notes.some((n) => /as[- ]of|al\s+\d{1,2}|timezone|tz|CDMX/i.test(n))
      return ok
        ? null
        : { ruleId: "DATES_NEED_CONTEXT", severity: "info", message: "Dates referenced but no as-of/timezone context in notes." }
    },
  },
];


/* ===== FILE: src/rts/ui/Callout.tsx ===== */
// src/rts/ui/Callout.tsx
import { Text } from "./Text"

export function Callout(props: { title: string; body: string; tone?: "info" | "warn" | "critical" }) {
  const tone = props.tone ?? "info"
  const border =
    tone === "critical"
      ? "rgba(140,58,58,0.70)"
      : tone === "warn"
        ? "rgba(171,123,38,0.70)"
        : "rgba(2,167,202,0.70)"

  const bg =
    tone === "critical"
      ? "rgba(140,58,58,0.18)"
      : tone === "warn"
        ? "rgba(171,123,38,0.18)"
        : "rgba(2,167,202,0.16)"

  return (
    <div style={{ borderRadius: 16, border: "1px solid " + border, background: bg, padding: 14 }}>
      <Text variant="micro" className="vs-muted">
        {props.title}
      </Text>
      <div style={{ marginTop: 8 }}>
        <Text variant="body">{props.body}</Text>
      </div>
    </div>
  )
}


/* ===== FILE: src/rts/ui/DecisionCard.tsx ===== */
// src/ui/DecisionCard.tsx
import type { DecisionRecord } from "../foundation/smartservices_types";
import { Panel } from "./Panel";
import { Stack } from "./Stack";
import { Text } from "./Text";
import { StatusPill } from "./StatusPill";

export function DecisionCard(props: { record: DecisionRecord }) {
  const { record } = props;
  return (
    <Panel variant="soft" className="p-4">
      <Stack gap={10}>
        <div style={{ display: "flex", justifyContent: "space-between", gap: 10 }}>
          <Text variant="kicker">Decision</Text>
          <StatusPill state={record.state} />
        </div>

        <Text variant="h2">{record.question}</Text>

        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
          <Text variant="micro">
            <span className="vs-fg-2">Owner:</span> {record.owner}
          </Text>
          <Text variant="micro">
            <span className="vs-fg-2">Source:</span> {record.sourceRef ?? "Unavailable"}
          </Text>
          <Text variant="micro">
            <span className="vs-fg-2">Verification:</span> {record.verificationRef ?? "Pending"}
          </Text>
          <Text variant="micro">
            <span className="vs-fg-2">Trace:</span> {record.id}
          </Text>
        </div>

        <div style={{ display: "grid", gap: 10 }}>
          {record.options.map((o) => (
            <Panel key={o.id} className="p-3">
              <Text variant="body">{o.label}</Text>
              {o.tradeoffs ? <Text variant="micro">{o.tradeoffs}</Text> : null}
              <Text variant="micro">
                <span className="vs-fg-2">Evidence:</span> {o.evidenceRef ?? "Pending"}
              </Text>
            </Panel>
          ))}
        </div>

        <Text variant="body">
          <span className="vs-fg-2">Recommendation:</span> {record.recommendation ?? "Pending"}
        </Text>

        <Text variant="body">
          <span className="vs-fg-2">Next action:</span> {record.nextAction ?? "Pending"}
        </Text>
      </Stack>
    </Panel>
  );
}


/* ===== FILE: src/rts/ui/ExecutiveHeader.tsx ===== */
// src/ui/ExecutiveHeader.tsx
import { Text } from "./Text";
import { Rule } from "./Rule";

export function ExecutiveHeader(props: {
  title: string;
  breadcrumb?: string;
  slideNum?: number | string;
  rightBadge?: string;
}) {
  const { title, breadcrumb = "HITECH", slideNum, rightBadge } = props;
  const slideLabel =
    typeof slideNum === "number" ? String(slideNum).padStart(2, "0") : slideNum;

  return (
    <div className="w-full">
      <div className="flex items-start justify-between gap-6">
        <div className="min-w-0">
          <Text variant="kicker">
            {breadcrumb}
            {slideLabel ? (
              <span style={{ marginLeft: 12, opacity: 0.75 }}>
                / SLIDE {slideLabel}
              </span>
            ) : null}
          </Text>

          <div style={{ marginTop: 10 }}>
            <Text variant="title" className="font-display">
              {title}
            </Text>
          </div>

          <div style={{ marginTop: 16, maxWidth: 520 }}>
            <Rule />
          </div>
        </div>

        {rightBadge ? (
          <div className="shrink-0">
            <div
              className="vs-panel--soft"
              style={{
                padding: "10px 12px",
                borderRadius: "var(--vs-r-2)",
              }}
            >
              <Text variant="micro" className="font-code" style={{ letterSpacing: "0.24em" }}>
                {rightBadge}
              </Text>
            </div>
          </div>
        ) : null}
      </div>
    </div>
  );
}


/* ===== FILE: src/rts/ui/ExecutiveNav.tsx ===== */
// src/ui/ExecutiveNav.tsx
import React from "react";
import { Text } from "./Text";

export function ExecutiveNav(props: {
  prev?: () => void;
  next?: () => void;
  labelPrev?: string;
  labelNext?: string;
}) {
  const { prev, next, labelPrev = "PREV", labelNext = "NEXT" } = props;

  const btnBase =
    "vs-motion px-5 py-3 rounded-xl border bg-black/35 text-white/70 hover:text-white hover:bg-black/45";
  const btnBorder = { borderColor: "var(--vs-line-1)" } as React.CSSProperties;

  return (
    <div className="absolute bottom-8 left-0 right-0 z-30 px-12">
      <div className="flex items-center justify-between">
        <button
          onClick={prev}
          className={[btnBase, prev ? "" : "opacity-40 pointer-events-none"].join(" ").trim()}
          style={btnBorder}
        >
          <Text as="span" variant="micro" className="font-code" style={{ letterSpacing: "0.28em" }}>
            ← {labelPrev}
          </Text>
        </button>

        <button
          onClick={next}
          className={[btnBase, next ? "" : "opacity-40 pointer-events-none"].join(" ").trim()}
          style={btnBorder}
        >
          <Text as="span" variant="micro" className="font-code" style={{ letterSpacing: "0.28em" }}>
            {labelNext} →
          </Text>
        </button>
      </div>
    </div>
  );
}


/* ===== FILE: src/rts/ui/KpiCard.tsx ===== */
// src/rts/ui/KpiCard.tsx
import { Text } from "./Text"

export function KpiCard(props: {
  label: string
  value: string
  hint?: string
  state?: "stable" | "watch" | "alert" | "critical" | "muted"
}) {
  const { label, value, hint, state = "muted" } = props
  const bgVar =
    state === "stable"
      ? "var(--vs-state-stable)"
      : state === "watch"
        ? "var(--vs-state-watch)"
        : state === "alert"
          ? "var(--vs-state-alert)"
          : state === "critical"
            ? "var(--vs-state-critical)"
            : "var(--vs-state-muted)"

  return (
    <div style={{ background: bgVar, borderRadius: 16, padding: 14, border: "1px solid rgba(255,255,255,0.10)" }}>
      <Text variant="micro" className="vs-muted">
        {label}
      </Text>
      <div style={{ marginTop: 6 }}>
        <Text variant="h2" className="vs-kpi">
          {value}
        </Text>
      </div>
      {hint ? (
        <div style={{ marginTop: 6 }}>
          <Text variant="micro" className="vs-muted">
            {hint}
          </Text>
        </div>
      ) : null}
    </div>
  )
}


/* ===== FILE: src/rts/ui/Panel.tsx ===== */
// src/ui/Panel.tsx
import React from "react";

export function Panel(
  props: React.PropsWithChildren<{
    variant?: "solid" | "soft";
    className?: string;
    style?: React.CSSProperties;
    title?: string;
    rightBadge?: string;
  }>
) {
  const { variant = "solid", className = "", style, children } = props;
  const base = variant === "soft" ? "vs-panel--soft" : "vs-panel";
  return (
    <div className={[base, "vs-motion", className].join(" ").trim()} style={style}>
      {children}
    </div>
  );
}


/* ===== FILE: src/rts/ui/RiskCard.tsx ===== */
// src/ui/RiskCard.tsx
import type { RiskItem } from "../foundation/smartservices_types";
import { Panel } from "./Panel";
import { Stack } from "./Stack";
import { Text } from "./Text";
import { StatusPill } from "./StatusPill";

export function RiskCard(props: { item: RiskItem }) {
  const { item } = props;
  const band = (x?: string) => x ?? "Unavailable";
  return (
    <Panel variant="soft" className="p-4">
      <Stack gap={8}>
        <div style={{ display: "flex", justifyContent: "space-between", gap: 10 }}>
          <Text variant="kicker">Risk</Text>
          <StatusPill state={item.state} />
        </div>

        <Text variant="h2">{item.label}</Text>

        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
          <Text variant="micro">
            <span className="vs-fg-2">Owner:</span> {item.owner}
          </Text>
          <Text variant="micro">
            <span className="vs-fg-2">Evidence:</span> {item.evidenceRef ?? "Pending"}
          </Text>
          <Text variant="micro">
            <span className="vs-fg-2">Probability band:</span> {band(item.probability)}
          </Text>
          <Text variant="micro">
            <span className="vs-fg-2">Impact band:</span> {band(item.impact)}
          </Text>
        </div>

        {item.mitigation ? (
          <Text variant="body">
            <span className="vs-fg-2">Next action:</span> {item.mitigation}
          </Text>
        ) : (
          <Text variant="body">
            <span className="vs-fg-2">Next action:</span> Pending
          </Text>
        )}
      </Stack>
    </Panel>
  );
}


/* ===== FILE: src/rts/ui/Rule.tsx ===== */
// src/ui/Rule.tsx
import React from "react";

export function Rule(props: { className?: string; style?: React.CSSProperties }) {
  const { className = "", style } = props;
  return <div className={["vs-rule", className].join(" ").trim()} style={style} />;
}


/* ===== FILE: src/rts/ui/SlideFrame.tsx ===== */
// src/ui/SlideFrame.tsx
import React from "react";

export function SlideFrame(props: React.PropsWithChildren<{ className?: string; style?: React.CSSProperties }>) {
  const { className = "", style, children } = props;
  return (
    <div className={["rts-root vs-canvas vs-pad-outer w-full h-full", className].join(" ").trim()} style={style}>
      {children}
    </div>
  );
}

export function SlideGrid(props: React.PropsWithChildren<{ className?: string; style?: React.CSSProperties }>) {
  const { className = "", style, children } = props;
  return (
    <div className={["vs-grid w-full", className].join(" ").trim()} style={style}>
      {children}
    </div>
  );
}


/* ===== FILE: src/rts/ui/Stack.tsx ===== */
// src/ui/Stack.tsx
import React from "react";

export function Stack(props: React.PropsWithChildren<{ gap?: number; className?: string }>) {
  const { gap = 16, className = "", children } = props;
  return (
    <div className={["flex flex-col", className].join(" ").trim()} style={{ gap }}>
      {children}
    </div>
  );
}


/* ===== FILE: src/rts/ui/StatusPill.tsx ===== */
// src/ui/StatusPill.tsx
import type { CanonState } from "../foundation/smartservices_types";

function stateClass(state: CanonState) {
  switch (state) {
    case "Stable":
      return "vs-state vs-state--stable";
    case "Watch":
      return "vs-state vs-state--watch";
    case "Alert":
      return "vs-state vs-state--alert";
    case "Critical":
      return "vs-state vs-state--critical";
    default:
      return "vs-state vs-state--muted";
  }
}

export function StatusPill(props: { state: CanonState; className?: string }) {
  const { state, className = "" } = props;
  return (
    <span className={[stateClass(state), className].join(" ").trim()}>
      {state}
    </span>
  );
}


/* ===== FILE: src/rts/ui/Text.tsx ===== */
// src/ui/Text.tsx
import React from "react";

type Variant = "kicker" | "title" | "h2" | "body" | "micro";

type Props = React.PropsWithChildren<{
  as?: keyof JSX.IntrinsicElements;
  variant?: Variant;
  className?: string;
  style?: React.CSSProperties;
}>;

const variantClass: Record<Variant, string> = {
  kicker: "vs-kicker font-code",
  title: "vs-title font-display",
  h2: "vs-h2 font-main",
  body: "vs-body font-main",
  micro: "vs-micro font-code",
};

export function Text({ as = "div", variant = "body", className = "", style, children }: Props) {
  const Comp: any = as;
  return (
    <Comp className={[variantClass[variant], className].join(" ").trim()} style={style}>
      {children}
    </Comp>
  );
}


/* ===== FILE: src/rts/utils/hashQuery.ts ===== */
// src/rts/utils/hashQuery.ts
export function getHashSearchParams(): URLSearchParams {
  const h = typeof window !== "undefined" ? window.location.hash : ""
  const qIndex = h.indexOf("?")
  if (qIndex === -1) return new URLSearchParams("")
  return new URLSearchParams(h.slice(qIndex + 1))
}


/* ===== FILE: src/shared/config/constants.ts ===== */
export const APP = {
  name: "inversion-next",
  title: "Hitech Inversion Next",
  version: "0.1.0",
  timezoneHint: "America/Mexico_City",
} as const;

export const BRAND = {
  colors: {
    gold: "#AB7B26",
    teal900: "#026F86",
    teal600: "#02A7CA",
    brown: "#553E13",
  },
} as const;

export const DECK = {
  width: 1600,
  height: 900,
  route: "/deck",
  totalSlides: 12,
  keyboard: {
    next: ["ArrowRight", "PageDown", " "],
    prev: ["ArrowLeft", "PageUp"],
    first: ["Home"],
    last: ["End"],
  },
} as const;

export const UI = {
  headerHeight: 92,
  footerHeight: 64,
  safePadding: 56,
  maxContentWidth: 1480,
} as const;

export const TEXT = {
  coverTagline: "Interactive deck engine",
  footerRight: "Hitech",
} as const;

/* ===== FILE: src/shared/hooks/useHiGrain.ts ===== */
import { useEffect } from "react"
import { createNoise2D } from "simplex-noise"

/**
 * Grain realista sin assets:
 * - Genera noise fino en canvas
 * - Inyecta a :root como --hi-grain-url (data-uri)
 *
 * Acepta seed number o string (string se hashea).
 */
export function useHiGrain(opts?: {
    size?: number
    alpha?: number
    seed?: number | string
}) {
    useEffect(() => {
        const size = opts?.size ?? 256
        const alpha = opts?.alpha ?? 0.18
        const seedIn = opts?.seed ?? 1337

        // Hash determinista para strings (FNV-1a-ish)
        const seed =
            typeof seedIn === "number"
                ? seedIn >>> 0
                : hashToUint32(seedIn)

        try {
            const canvas = document.createElement("canvas")
            canvas.width = size
            canvas.height = size

            const ctx = canvas.getContext("2d", { willReadFrequently: true })
            if (!ctx) return

            const img = ctx.createImageData(size, size)

            // createNoise2D acepta función random; hacemos pseudo-random determinista
            let s = seed >>> 0
            const rand = () => {
                // xorshift32
                s ^= s << 13
                s ^= s >>> 17
                s ^= s << 5
                return ((s >>> 0) % 1000000) / 1000000
            }

            const noise2D = createNoise2D(rand)

            for (let y = 0; y < size; y++) {
                for (let x = 0; x < size; x++) {
                    const i = (y * size + x) * 4

                    const nx = x / size
                    const ny = y / size

                    const n1 = noise2D(nx * 6, ny * 6)        // -1..1
                    const n2 = noise2D(nx * 22, ny * 22) * 0.35
                    const n = (n1 + n2) * 0.5

                    const v = Math.max(0, Math.min(255, Math.floor((n * 0.5 + 0.5) * 255)))

                    // “salt & pepper” MUY sutil
                    const pepper = (x * 13 + y * 7) % 97 === 0 ? 255 : 0
                    const val = Math.min(255, v + pepper * 0.12)

                    img.data[i + 0] = val
                    img.data[i + 1] = val
                    img.data[i + 2] = val
                    img.data[i + 3] = Math.floor(255 * alpha)
                }
            }

            ctx.putImageData(img, 0, 0)

            const url = canvas.toDataURL("image/png")
            document.documentElement.style.setProperty("--hi-grain-url", `url("${url}")`)
        } catch (e) {
            console.warn("[useHiGrain] failed to generate grain:", e)
        }
    }, [opts?.size, opts?.alpha, opts?.seed])
}

function hashToUint32(str: string) {
    let h = 2166136261 >>> 0
    for (let i = 0; i < str.length; i++) {
        h ^= str.charCodeAt(i)
        h = Math.imul(h, 16777619)
    }
    return h >>> 0
}


/* ===== FILE: src/shared/lib/cn.ts ===== */
import { clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: Array<string | undefined | null | false>) {
  return twMerge(clsx(inputs))
}


/* ===== FILE: src/shared/lib/hotkeys.ts ===== */
export function bindHotkey(handler: (e: KeyboardEvent) => void) {
  if (typeof window === 'undefined') return () => {};
  window.addEventListener('keydown', handler);
  return () => window.removeEventListener('keydown', handler);
}


/* ===== FILE: src/shared/mocks/browser.ts ===== */
import { setupWorker } from 'msw/browser';
import { handlers } from './handlers';

export const worker = setupWorker(...handlers);


/* ===== FILE: src/shared/mocks/data.ts ===== */
export type MockUser = {
  id: string;
  name: string;
  tier: 'starter' | 'pro' | 'vip';
};

export type MockHolding = {
  symbol: string;
  name: string;
  allocationPct: number; // 0-100
  amount: number; // MXN
  risk: 'bajo' | 'medio' | 'alto';
};

export type MockPortfolio = {
  asOf: string; // ISO date
  currency: 'MXN';
  total: number;
  dailyChangePct: number;
  holdings: MockHolding[];
};

export type MockPoint = {
  date: string; // YYYY-MM-DD
  value: number;
};

export type MockPerformance = {
  range: '7d' | '30d' | '180d' | '1y';
  points: MockPoint[];
};

export const mockUser: MockUser = {
  id: 'u_alan_001',
  name: 'Alan',
  tier: 'pro',
};

export const mockPortfolio: MockPortfolio = {
  asOf: new Date().toISOString(),
  currency: 'MXN',
  total: 256_420,
  dailyChangePct: 1.27,
  holdings: [
    { symbol: 'ETF-MX', name: 'ETF Mercado MX', allocationPct: 35, amount: 89_747, risk: 'medio' },
    { symbol: 'BONOS', name: 'Bonos Gobierno', allocationPct: 25, amount: 64_105, risk: 'bajo' },
    { symbol: 'TEC', name: 'Tech Growth', allocationPct: 20, amount: 51_284, risk: 'alto' },
    { symbol: 'CASH', name: 'Efectivo', allocationPct: 20, amount: 51_284, risk: 'bajo' },
  ],
};

function series(days: number, start: number, drift: number) {
  const out: MockPoint[] = [];
  let v = start;
  const today = new Date();
  for (let i = days - 1; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(today.getDate() - i);
    const noise = (Math.random() - 0.5) * drift * 0.9;
    v = Math.max(0, v + drift + noise);
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    out.push({ date: yyyy + '-' + mm + '-' + dd, value: Math.round(v) });
  }
  return out;
}

export const mockPerformance: Record<MockPerformance['range'], MockPerformance> = {
  '7d': { range: '7d', points: series(7, 242_000, 520) },
  '30d': { range: '30d', points: series(30, 218_000, 380) },
  '180d': { range: '180d', points: series(180, 160_000, 210) },
  '1y': { range: '1y', points: series(365, 120_000, 140) },
};


/* ===== FILE: src/shared/mocks/handlers.ts ===== */
import { http, HttpResponse, delay } from 'msw';
import { mockPortfolio, mockPerformance, mockUser } from './data';

export const handlers = [
  http.get('/api/me', async () => {
    await delay(180);
    return HttpResponse.json(mockUser);
  }),

  http.get('/api/portfolio', async () => {
    await delay(320);
    return HttpResponse.json(mockPortfolio);
  }),

  http.get('/api/performance', async ({ request }) => {
    await delay(280);
    const url = new URL(request.url);
    const range = (url.searchParams.get('range') || '30d') as keyof typeof mockPerformance;
    const payload = mockPerformance[range] || mockPerformance['30d'];
    return HttpResponse.json(payload);
  }),
];


/* ===== FILE: src/shared/render/effects/chartSurfaceHighlight.css ===== */
/* =========================================================
   Effect: chartSurfaceHighlight (v1)
   - Highlight lento y físico
   ========================================================= */

:root {
  --hi-chart-highlight-opacity: 0.10;
  --hi-chart-highlight-period: 14s;
}

/* Wrapper opt-in */
[data-chart-highlight="on"] {
  position: relative;
}

/* Capa highlight */
[data-chart-highlight="on"]::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;

  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255,255,255, 0.0) 35%,
    rgba(255,255,255, var(--hi-chart-highlight-opacity)) 50%,
    rgba(255,255,255, 0.0) 65%,
    transparent 100%
  );

  opacity: 0;
  transform: translateX(-20%);
  mix-blend-mode: screen;

  animation: hi-chartHighlight var(--hi-chart-highlight-period) ease-in-out infinite;
}

@keyframes hi-chartHighlight {
  0%   { opacity: 0; transform: translateX(-20%); }
  30%  { opacity: 0; }
  55%  { opacity: 1; transform: translateX(0%); }
  75%  { opacity: 0; transform: translateX(20%); }
  100% { opacity: 0; transform: translateX(20%); }
}


/* ===== FILE: src/shared/render/effects/contactOcclusion.css ===== */
/* =========================================================
   Effect: contactOcclusion (v1)
   - Volumen sutil en bordes/base
   ========================================================= */

:root {
  --hi-contact-occlusion: 0.12;
}

/* Aplica a cualquier material glass */
[data-material^="glass"] {
  position: relative;
}

/* Capa de contacto */
[data-material^="glass"]::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;

  border-radius: inherit;

  background:
    linear-gradient(
      to bottom,
      rgba(0,0,0, 0.0) 70%,
      rgba(0,0,0, var(--hi-contact-occlusion)) 100%
    ),
    linear-gradient(
      to right,
      rgba(0,0,0, var(--hi-contact-occlusion)) 0%,
      rgba(0,0,0, 0.0) 12%
    ),
    linear-gradient(
      to left,
      rgba(0,0,0, var(--hi-contact-occlusion)) 0%,
      rgba(0,0,0, 0.0) 12%
    );
}


/* ===== FILE: src/shared/render/effects/dustField.css ===== */
/* =========================================================
   Effect: dustField (v1)
   - Micro polvo ambiental
   - Global, ultra sutil
   ========================================================= */

:root {
  --hi-dust-opacity-a: 0.025;
  --hi-dust-opacity-b: 0.015;
  --hi-dust-period-a: 38s;
  --hi-dust-period-b: 61s;
}

/* Capa A */
.hi-stage::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;

  background:
    radial-gradient(
      1px 1px at 20% 30%,
      rgba(255,255,255, var(--hi-dust-opacity-a)),
      transparent 40%
    ),
    radial-gradient(
      1px 1px at 70% 60%,
      rgba(255,255,255, var(--hi-dust-opacity-a)),
      transparent 40%
    ),
    radial-gradient(
      1px 1px at 40% 80%,
      rgba(255,255,255, var(--hi-dust-opacity-a)),
      transparent 40%
    );

  animation: hi-dustA var(--hi-dust-period-a) linear infinite;
}

/* Capa B (desfasada) */
.hi-stage::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;

  background:
    radial-gradient(
      1px 1px at 10% 20%,
      rgba(255,255,255, var(--hi-dust-opacity-b)),
      transparent 40%
    ),
    radial-gradient(
      1px 1px at 80% 40%,
      rgba(255,255,255, var(--hi-dust-opacity-b)),
      transparent 40%
    ),
    radial-gradient(
      1px 1px at 55% 75%,
      rgba(255,255,255, var(--hi-dust-opacity-b)),
      transparent 40%
    );

  animation: hi-dustB var(--hi-dust-period-b) linear infinite;
}

@keyframes hi-dustA {
  from { transform: translateY(0px); }
  to   { transform: translateY(-18px); }
}

@keyframes hi-dustB {
  from { transform: translateY(0px); }
  to   { transform: translateY(-26px); }
}


/* ===== FILE: src/shared/render/effects/glintSlow.css ===== */
/* =========================================================
   Effect: glintSlow (v2)
   - Color variante (silver/gold/emerald/cyan/red)
   - Más presencia sin neon
   - Solo para glassCritical
   ========================================================= */

:root {
  /* Presencia */
  --hi-glint-opacity: 0.08; /* subimos default: estaba tímido */
  --hi-glint-period: 14s;

  /* Color (default: plata) */
  --hi-glint-rgb: 235 245 255; /* silver */

  /* Blend control (para que NO se tiña de oro) */
  --hi-glint-blend: normal; /* normal = más “plata real” */
}

/* Activación: solo material critical */
[data-material="glassCritical"] {
  position: relative;
  isolation: isolate;
}

/* Variantes de color (si no pones data-glint, cae en plata) */
[data-material="glassCritical"][data-glint="silver"] { --hi-glint-rgb: 235 245 255; }
[data-material="glassCritical"][data-glint="gold"] { --hi-glint-rgb: 255 210 120; }
[data-material="glassCritical"][data-glint="emerald"] { --hi-glint-rgb: 80 255 180; }
[data-material="glassCritical"][data-glint="cyan"] { --hi-glint-rgb: 120 255 255; }
[data-material="glassCritical"][data-glint="red"] { --hi-glint-rgb: 255 110 110; }

/* Si algún día quieres “screen”, lo activas por atributo */
[data-material="glassCritical"][data-glint-blend="screen"] { --hi-glint-blend: screen; }

/* Capa glint */
[data-material="glassCritical"]::after {
  content: "";
  position: absolute;
  inset: -30%;
  pointer-events: none;
  z-index: 0;

  /* Glint más “ancho” para que no sea tímido */
  background: linear-gradient(
    115deg,
    transparent 0%,
    rgb(var(--hi-glint-rgb) / 0.00) 34%,
    rgb(var(--hi-glint-rgb) / calc(var(--hi-glint-opacity) * 0.35)) 42%,
    rgb(var(--hi-glint-rgb) / var(--hi-glint-opacity)) 50%,
    rgb(var(--hi-glint-rgb) / calc(var(--hi-glint-opacity) * 0.35)) 58%,
    rgb(var(--hi-glint-rgb) / 0.00) 66%,
    transparent 100%
  );

  /* Suavizado mínimo, no blur gordo */
  filter: blur(0.7px);

  opacity: 0;
  transform: translateX(-18%) translateY(8%);

  /* Controlado para que NO se pinte dorado por el set */
  mix-blend-mode: var(--hi-glint-blend);

  animation: hi-glintSlow var(--hi-glint-period) ease-in-out infinite;
}

/* Animación lenta, con “tiempo visible” extra */
@keyframes hi-glintSlow {
  0% {
    opacity: 0;
    transform: translateX(-22%) translateY(10%);
  }
  18% {
    opacity: 0;
  }
  42% {
    opacity: 1;
    transform: translateX(-2%) translateY(2%);
  }
  55% {
    opacity: 1;
    transform: translateX(6%) translateY(-2%);
  }
  74% {
    opacity: 0;
    transform: translateX(18%) translateY(-8%);
  }
  100% {
    opacity: 0;
    transform: translateX(22%) translateY(-10%);
  }
}


/* ===== FILE: src/shared/render/effects/mirrorCine.css ===== */
/* =========================================================
   Effect: mirrorCine (v1 - TURBO)
   - Reflejo inferior cinematográfico
   - Solo masa visual
   ========================================================= */

:root {
  --hi-mirror-strength: 0.14;
  --hi-mirror-blur: 10px;
  --hi-mirror-fade: 55%;
}

/* Host del espejo (wrapper, no el componente) */
[data-mirror="on"] {
  position: relative;
}

/* Capa espejo */
[data-mirror="on"]::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 100%;
  height: 42%;

  pointer-events: none;

  /* Copia visual */
  background: inherit;

  /* Voltear */
  transform: scaleY(-1);

  /* Blur controlado */
  filter: blur(var(--hi-mirror-blur));

  /* Fade cinematográfico */
  mask-image: linear-gradient(
    to bottom,
    rgba(0,0,0, var(--hi-mirror-strength)) 0%,
    rgba(0,0,0, 0.35) 25%,
    rgba(0,0,0, 0.10) var(--hi-mirror-fade),
    rgba(0,0,0, 0.0) 100%
  );

  opacity: var(--hi-mirror-strength);
}


/* ===== FILE: src/shared/render/effects/rimDynamic.css ===== */
/* =========================================================
   Effect: rimDynamic (v1 - TURBO)
   - Micro shimmer irregular
   - No loop evidente
   ========================================================= */

:root {
  --hi-rim-strength: 0.12;
  --hi-rim-jitter-a: 0.035;
  --hi-rim-jitter-b: 0.022;
  --hi-rim-period-a: 19s;
  --hi-rim-period-b: 31s;
}

/* Aplica a todo panel con material glass */
[data-material^="glass"] {
  position: relative;
}

/* Rim layer */
[data-material^="glass"]::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;

  border-radius: inherit;

  background:
    linear-gradient(
      180deg,
      rgba(255,255,255, calc(var(--hi-rim-strength) * 0.9)),
      rgba(255,255,255, 0.0) 45%
    ),
    linear-gradient(
      90deg,
      rgba(255,255,255, calc(var(--hi-rim-strength) * 0.6)),
      rgba(255,255,255, 0.0) 35%
    );

  opacity: 0.55;

  animation:
    hi-rimJitterA var(--hi-rim-period-a) ease-in-out infinite,
    hi-rimJitterB var(--hi-rim-period-b) ease-in-out infinite;
}

/* Animaciones desfasadas */
@keyframes hi-rimJitterA {
  0%   { opacity: 0.52; }
  50%  { opacity: calc(0.52 + var(--hi-rim-jitter-a)); }
  100% { opacity: 0.52; }
}

@keyframes hi-rimJitterB {
  0%   { opacity: 0.55; }
  50%  { opacity: calc(0.55 + var(--hi-rim-jitter-b)); }
  100% { opacity: 0.55; }
}


/* ===== FILE: src/shared/render/materials/materials.css ===== */
/* ==================================================
   Render Materials v1.5 (Upgraded)
   - No layout
   - No effects globales
   - Solo seteo de tokens + overlays internos por material
   ========================================================= */

/* =========================================================
   BASE MATERIAL BEHAVIOR
   - Estos overlays NO dependen de layout externo.
   - Requiere que el elemento material tenga:
     position: relative; overflow: hidden;
     (si no lo tienen, lo inyectamos aquí sin romper layout)
   ========================================================= */

[data-material] {
  position: relative;
  overflow: hidden;

  /* default fallbacks por si falta algo */
  --hi-glass-opacity: 0.08;
  --hi-glass-frost: 0.10;

  --hi-rim-strength: 0.10;
  --hi-spec-strength: 0.12;
  --hi-grain-amount: 0.08;

  --hi-glow-strength: 0.00;
  --hi-glint-opacity: 0.00;

  /* color accents (puedes tunear si quieres) */
  --hi-accent-cyan: 160, 220, 255;
  --hi-accent-pink: 255, 180, 220;
}

/* ---------------------------------------------------------
   PANEL GLASS OVERLAY STACK
   ::before = starfield + haze interno (screen)
   ::after  = glare diagonal + rim tint (screen)
---------------------------------------------------------- */

[data-material="glassCold"]::before,
[data-material="glassCritical"]::before {
  content: "";
  position: absolute;
  inset: -12%;
  pointer-events: none;
  z-index: 0;

  /* universo dentro del vidrio */
  background-image:
    /* fine stars */
    radial-gradient(1px 1px at 12% 18%, rgba(255, 255, 255, 0.45), transparent 45%),
    radial-gradient(1px 1px at 22% 72%, rgba(255, 255, 255, 0.22), transparent 45%),
    radial-gradient(1px 1px at 38% 44%, rgba(255, 255, 255, 0.18), transparent 45%),
    radial-gradient(1px 1px at 49% 12%, rgba(255, 255, 255, 0.34), transparent 45%),
    radial-gradient(1px 1px at 57% 63%, rgba(255, 255, 255, 0.20), transparent 45%),
    radial-gradient(1px 1px at 66% 28%, rgba(255, 255, 255, 0.22), transparent 45%),
    radial-gradient(1px 1px at 78% 58%, rgba(255, 255, 255, 0.14), transparent 45%),
    radial-gradient(1px 1px at 86% 22%, rgba(255, 255, 255, 0.20), transparent 45%),
    radial-gradient(1px 1px at 92% 76%, rgba(255, 255, 255, 0.15), transparent 45%),
    radial-gradient(1px 1px at 8% 86%, rgba(255, 255, 255, 0.14), transparent 45%),

    /* luminous anchors (antes “fat stars” 😌) */
    radial-gradient(3px 3px at 72% 78%, rgba(var(--hi-accent-cyan), 0.12), transparent 70%),
    radial-gradient(3px 3px at 28% 74%, rgba(var(--hi-accent-pink), 0.10), transparent 70%),
    radial-gradient(2px 2px at 18% 30%, rgba(255, 255, 255, 0.12), transparent 62%),

    /* soft haze inside */
    radial-gradient(900px 520px at 60% 25%, rgba(var(--hi-accent-cyan), 0.05), transparent 68%),
    radial-gradient(900px 520px at 40% 75%, rgba(var(--hi-accent-pink), 0.04), transparent 70%);

  mix-blend-mode: screen;
  filter: blur(0.25px) saturate(1.10);
  opacity: calc(0.18 + (var(--hi-glow-strength) * 0.9));
  transform: translateZ(0);
}

[data-material="glassCold"]::after,
[data-material="glassCritical"]::after {
  content: "";
  position: absolute;
  inset: -20%;
  pointer-events: none;
  z-index: 0;

  /* glare diagonal + rim tint */
  background:
    linear-gradient(120deg,
      transparent 0%,
      rgba(255, 255, 255, 0.05) 30%,
      rgba(255, 255, 255, 0.12) 42%,
      rgba(255, 255, 255, 0.05) 54%,
      transparent 70%),
    radial-gradient(900px 420px at 18% 28%, rgba(var(--hi-accent-cyan), 0.06), transparent 60%),
    radial-gradient(900px 420px at 82% 28%, rgba(var(--hi-accent-pink), 0.05), transparent 60%);

  mix-blend-mode: screen;
  filter: blur(0.8px);
  opacity: calc(0.10 + (var(--hi-glint-opacity) * 1.2) + (var(--hi-rim-strength) * 0.9));
  transform: rotate(-6deg) translateZ(0);
}

/* Asegura que el contenido real esté encima de overlays */
[data-material="glassCold"]>*,
[data-material="glassCritical"]>* {
  position: relative;
  z-index: 1;
}

/* =========================================================
   GLASS: COLD (default panel)
   - sutil, elegante, cosmos tenue
   ========================================================= */
[data-material="glassCold"] {
  --hi-glass-opacity: 0.10;
  --hi-glass-frost: 0.12;

  --hi-rim-strength: 0.10;
  --hi-spec-strength: 0.12;
  --hi-grain-amount: 0.10;

  --hi-glow-strength: 0.04;
  /* <- antes 0, ahora “vivo” */
  --hi-glint-opacity: 0.06;
  /* <- tiny sparkle */
}

/* =========================================================
   GLASS: CRITICAL (KPI / panel dominante)
   - más glow, más “premium”
   ========================================================= */
[data-material="glassCritical"] {
  --hi-glass-opacity: 0.12;
  --hi-glass-frost: 0.10;

  --hi-rim-strength: 0.16;
  --hi-spec-strength: 0.18;

  --hi-glow-strength: 0.10;
  /* <- sube el cosmos dentro */
  --hi-glint-opacity: 0.12;
  /* <- glare más presente */
}

/* =========================================================
   METAL FRAME
   ========================================================= */
[data-material="metalFrame"] {
  --hi-rim-strength: 0.08;
  --hi-spec-strength: 0.10;

  --hi-glass-opacity: 0.00;
  --hi-glass-frost: 0.00;
  --hi-grain-amount: 0.00;

  --hi-glow-strength: 0.00;
  --hi-glint-opacity: 0.00;
}

/* =========================================================
   CHART INK
   ========================================================= */
[data-material="chartInk"] {
  --hi-ink-contrast: 0.80;
  --hi-glow-strength: 0.00;
  --hi-grain-amount: 0.00;
}

/* =========================================================
   OPTIONAL: Micro-grain (inside glass) driven by token
   - No rayas diagonales, solo textura suave
   ========================================================= */
[data-material="glassCold"] .hi-grain,
[data-material="glassCritical"] .hi-grain {
  opacity: var(--hi-grain-amount);
}

/* ===== FILE: src/shared/render/qa/qa.stage.debug.css ===== */
/* QA debug toggles for stage/effects isolation */

html[data-qa="black"] .hi-stage {
  background: #000 !important;
}

html[data-qa="black"] .hi-stage::before,
html[data-qa="black"] .hi-stage::after,
html[data-qa="no-overlays"] .hi-stage::before,
html[data-qa="no-overlays"] .hi-stage::after {
  content: none !important;
  background: none !important;
  animation: none !important;
}

html[data-qa="no-dust"] {
  --hi-dust-opacity-a: 0;
  --hi-dust-opacity-b: 0;
}

html[data-qa="no-grain"] {
  --hi-grain-url: none !important;
}

html[data-qa="no-grain"] .hi-grain,
html[data-qa="no-grain"] .hi-grain::before,
html[data-qa="no-grain"] .hi-screen::after,
html[data-qa="no-grain"] .hi-chart::after {
  opacity: 0 !important;
  background-image: none !important;
}

html[data-qa="no-blend"] .hi-stage::before,
html[data-qa="no-blend"] .hi-stage::after,
html[data-qa="no-blend"] [data-material^="glass"]::before,
html[data-qa="no-blend"] [data-material^="glass"]::after,
html[data-qa="no-blend"] [data-chart-highlight="on"]::after,
html[data-qa="no-blend"] [data-mirror="on"]::after,
html[data-qa="no-blend"] .hi-panel::before,
html[data-qa="no-blend"] .hi-panel::after,
html[data-qa="no-blend"] .hi-screen::before,
html[data-qa="no-blend"] .hi-screen::after,
html[data-qa="no-blend"] .hi-chart::before,
html[data-qa="no-blend"] .hi-chart::after,
html[data-qa="no-blend"] .hi-glow,
html[data-qa="no-blend"] .hi-grain,
html[data-qa="no-blend"] .hi-grain::before,
html[data-qa="no-blend"] .hi-glassfx,
html[data-qa="no-blend"] .hi-glints,
html[data-qa="no-blend"] .hi-specular,
html[data-qa="no-blend"] .hi-inset,
html[data-qa="no-blend"] .hi-rim,
html[data-qa="no-blend"] .hi-mirror-wrap,
html[data-qa="no-blend"] .hi-mirror {
  mix-blend-mode: normal !important;
}

html[data-qa="no-filter"] .hi-stage::before,
html[data-qa="no-filter"] .hi-stage::after,
html[data-qa="no-filter"] [data-material^="glass"]::before,
html[data-qa="no-filter"] [data-material^="glass"]::after,
html[data-qa="no-filter"] [data-chart-highlight="on"]::after,
html[data-qa="no-filter"] [data-mirror="on"]::after,
html[data-qa="no-filter"] .hi-panel,
html[data-qa="no-filter"] .hi-panel::before,
html[data-qa="no-filter"] .hi-panel::after,
html[data-qa="no-filter"] .hi-screen::before,
html[data-qa="no-filter"] .hi-screen::after,
html[data-qa="no-filter"] .hi-chart::before,
html[data-qa="no-filter"] .hi-chart::after,
html[data-qa="no-filter"] .hi-glow,
html[data-qa="no-filter"] .hi-grain,
html[data-qa="no-filter"] .hi-grain::before,
html[data-qa="no-filter"] .hi-glassfx,
html[data-qa="no-filter"] .hi-glints,
html[data-qa="no-filter"] .hi-specular,
html[data-qa="no-filter"] .hi-inset,
html[data-qa="no-filter"] .hi-rim,
html[data-qa="no-filter"] .hi-mirror-wrap,
html[data-qa="no-filter"] .hi-mirror {
  filter: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}


/* ===== FILE: src/shared/render/stage/stage.css ===== */
/* Night Studio Stage (v2)
   - Neutral space/studio tones
   - Base glass plane baked into the background
   - Soft fades only, no hard cuts
*/

:root {
  /* Paint vars (neutral, space-like) */
  --hi-stage-core-a: 0.10;
  --hi-stage-edge-a: 0.08;
  --hi-stage-haze-a: 0.06;
  --hi-stage-plane-a: 0.06;
  --hi-stage-plane-b: 0.03;
  --hi-stage-vignette-a: 0.42;
}

/* Host */
.hi-stage {
  background:
    radial-gradient(1400px 900px at 20% -10%,
      rgba(160, 170, 190, var(--hi-stage-core-a)),
      transparent 62%),
    radial-gradient(1200px 800px at 85% 10%,
      rgba(130, 140, 160, var(--hi-stage-edge-a)),
      transparent 62%),
    radial-gradient(2400px 700px at 50% 120%,
      rgba(200, 210, 225, var(--hi-stage-plane-a)),
      transparent 60%),
    radial-gradient(1800px 420px at 50% 105%,
      rgba(255, 255, 255, var(--hi-stage-plane-b)),
      transparent 55%),
    radial-gradient(1600px 900px at 50% 50%,
      rgba(120, 130, 150, var(--hi-stage-haze-a)),
      transparent 65%),
    radial-gradient(2000px 1400px at 50% 50%,
      rgba(0, 0, 0, 0),
      rgba(0, 0, 0, var(--hi-stage-vignette-a)));
}

/* Grades (only intensities) */
.hi-stage[data-hi-grade="contrast"] {
  --hi-stage-core-a: 0.11;
  --hi-stage-edge-a: 0.09;
  --hi-stage-haze-a: 0.07;
  --hi-stage-plane-a: 0.07;
  --hi-stage-plane-b: 0.035;
  --hi-stage-vignette-a: 0.45;
}

.hi-stage {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;

  background:
    radial-gradient(1400px 900px at 20% -10%, rgba(160, 170, 190, var(--hi-stage-core-a)), transparent 62%),
    radial-gradient(1200px 800px at 85% 10%, rgba(130, 140, 160, var(--hi-stage-edge-a)), transparent 62%),
    radial-gradient(2400px 700px at 50% 120%, rgba(200, 210, 225, var(--hi-stage-plane-a)), transparent 60%),
    radial-gradient(1800px 420px at 50% 105%, rgba(255, 255, 255, var(--hi-stage-plane-b)), transparent 55%),
    radial-gradient(1600px 900px at 50% 50%, rgba(120, 130, 150, var(--hi-stage-haze-a)), transparent 65%),
    radial-gradient(2000px 1400px at 50% 50%, rgba(0, 0, 0, 0), rgba(0, 0, 0, var(--hi-stage-vignette-a)));
}


.hi-screen {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  isolation: isolate;
}

/* ===== FILE: src/shared/render/tokens/render.tokens.css ===== */
:root {
  /* === STAGE === */
  --hi-stage-key: 0.16;
  --hi-stage-fill: 0.10;
  --hi-stage-bounce: 0.07;
  --hi-stage-vignette: 0.18;
  --hi-stage-haze: 0.06;

  /* === MATERIAL === */
  --hi-glass-opacity: 0.10;
  --hi-glass-frost: 0.12;
  --hi-metal-strength: 0.18;
  --hi-ink-contrast: 0.78;
  --hi-edge-outer: rgba(255, 255, 255, 0.14);
  --hi-edge-inner: rgba(255, 255, 255, 0.07);

  /* === EFFECTS === */
  --hi-rim-strength: 0.12;
  --hi-spec-strength: 0.14;
  --hi-glint-opacity: 0.06;
  --hi-glow-strength: 0.08;
  --hi-grain-amount: 0.08;
  --hi-mirror-strength: 0.12;
  --hi-dust-density: 0.04;

  /* === MOTION === */
  --hi-glint-period: 14s;
  --hi-rim-shimmer-period: 24s;
  --hi-chart-highlight-period: 12s;
  --hi-dust-drift-period: 30s;
}


/* ===== FILE: src/shared/theme/tokens.css ===== */
:root{
  /* Hitech Brand */
  --hitech-gold: #AB7B26;
  --hitech-teal-900: #026F86;
  --hitech-teal-600: #02A7CA;
  --hitech-brown: #553E13;

  /* Base palette */
  --bg: #070A0F;
  --panel: rgba(255,255,255,0.06);
  --panel-2: rgba(255,255,255,0.10);
  --border: rgba(255,255,255,0.14);
  --text: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.70);
  --faint: rgba(255,255,255,0.55);

  /* Accents */
  --accent: var(--hitech-teal-600);
  --accent-2: var(--hitech-teal-900);
  --gold: var(--hitech-gold);

  /* Radii / spacing */
  --r-sm: 10px;
  --r-md: 16px;
  --r-lg: 22px;

  --space-1: 8px;
  --space-2: 12px;
  --space-3: 16px;
  --space-4: 24px;
  --space-5: 32px;
  --space-6: 40px;

  /* Typography */
  --font-sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";

  --h1: 56px;
  --h2: 34px;
  --h3: 22px;
  --p: 18px;
  --small: 14px;

  /* Motion */
  --ease: cubic-bezier(.2,.8,.2,1);
  --dur-1: 160ms;
  --dur-2: 280ms;
  --dur-3: 420ms;

  /* Deck geometry */
  --deck-w: 1600px;
  --deck-h: 900px;
}

/* Utility-ish */
.h-panel{
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--r-md);
  backdrop-filter: blur(10px);
}

.h-glow{
  box-shadow:
    0 0 0 1px rgba(2,167,202,.25),
    0 10px 40px rgba(2,167,202,.18);
}

/* ===== FILE: src/shared/ui/command-palette/CommandPalette.tsx ===== */
import * as React from "react"
import { createPortal } from "react-dom"
import { Command } from "cmdk"
import { ArrowLeft, ArrowRight, LayoutGrid, Search } from "lucide-react"
import { bindHotkey } from "../../lib/hotkeys"

type Action = {
  id: string
  title: string
  subtitle?: string
  icon?: React.ReactNode
  keywords?: string[]
  onRun: () => void
}

function safeDocument() {
  return typeof document !== "undefined" ? document : null
}

export function CommandPalette() {
  const [open, setOpen] = React.useState(false)
  const [query, setQuery] = React.useState("")

  React.useEffect(() => {
    const unbind = bindHotkey((e) => {
      const isK = e.key.toLowerCase() === "k"
      const mod = e.ctrlKey || e.metaKey

      if (mod && isK) {
        e.preventDefault()
        React.startTransition(() => setOpen((v) => !v))
      }

      if (e.key === "Escape") {
        React.startTransition(() => setOpen(false))
      }
    })
    return () => unbind()
  }, [])

  const actions = React.useMemo<Action[]>(() => {
    const nav = (sIndex: number) => () => {
      React.startTransition(() => {
        window.location.hash = `#/deck?s=${sIndex}`
        setOpen(false)
        setQuery("")
      })
    }

    return [
      { id: "go_deck", title: "Ir al Deck", subtitle: "Vista principal", icon: <LayoutGrid size={18} />, keywords: ["deck", "home"], onRun: nav(0) },
      { id: "slide_00", title: "Abrir slide-00", subtitle: "Intro", icon: <ArrowRight size={18} />, keywords: ["slide", "00"], onRun: nav(0) },
      { id: "slide_01", title: "Abrir slide-01", subtitle: "Siguiente", icon: <ArrowRight size={18} />, keywords: ["slide", "01"], onRun: nav(1) },
      { id: "slide_02", title: "Abrir slide-02", subtitle: "Dashboard", icon: <ArrowRight size={18} />, keywords: ["slide", "02", "dashboard"], onRun: nav(2) },
      { id: "slide_03", title: "Abrir slide-03", subtitle: "Contexto", icon: <ArrowRight size={18} />, keywords: ["slide", "03", "contexto"], onRun: nav(3) },
      { id: "slide_04", title: "Abrir slide-04", subtitle: "Sistema", icon: <ArrowRight size={18} />, keywords: ["slide", "04", "sistema"], onRun: nav(4) },
      { id: "slide_05", title: "Abrir slide-05", subtitle: "KPIs", icon: <ArrowRight size={18} />, keywords: ["slide", "05", "kpi"], onRun: nav(5) },
      { id: "slide_06", title: "Abrir slide-06", subtitle: "Timeline", icon: <ArrowRight size={18} />, keywords: ["slide", "06", "timeline"], onRun: nav(6) },
      { id: "slide_07", title: "Abrir slide-07", subtitle: "Riesgos", icon: <ArrowRight size={18} />, keywords: ["slide", "07", "riesgos"], onRun: nav(7) },
      {
        id: "prev",
        title: "Anterior",
        subtitle: "Slide anterior",
        icon: <ArrowLeft size={18} />,
        keywords: ["prev", "anterior"],
        onRun: () => {
          React.startTransition(() => {
            window.dispatchEvent(new CustomEvent("hitech:deck:prev"))
            setOpen(false)
          })
        },
      },
      {
        id: "next",
        title: "Siguiente",
        subtitle: "Slide siguiente",
        icon: <ArrowRight size={18} />,
        keywords: ["next", "siguiente"],
        onRun: () => {
          React.startTransition(() => {
            window.dispatchEvent(new CustomEvent("hitech:deck:next"))
            setOpen(false)
          })
        },
      },
    ]
  }, [])

  const doc = safeDocument()
  if (!doc) return null

  if (!open) return null

  const overlay = (
    <div
      style={{
        position: "fixed",
        inset: 0,
        zIndex: 9999,
        background: "rgba(0,0,0,0.55)",
        display: "flex",
        alignItems: "flex-start",
        justifyContent: "center",
        paddingTop: "10vh",
      }}
      onMouseDown={() => React.startTransition(() => setOpen(false))}
    >
      <div
        style={{
          width: "min(720px, calc(100vw - 24px))",
          borderRadius: 16,
          border: "1px solid rgba(255,255,255,0.10)",
          background: "rgba(10,14,20,0.98)",
          boxShadow: "0 24px 80px rgba(0,0,0,0.55)",
          overflow: "hidden",
        }}
        onMouseDown={(e) => e.stopPropagation()}
      >
        {/* ✅ cmdk CORRECTO: TODO dentro de <Command> */}
        <Command
          value={query}
          onValueChange={(v) => React.startTransition(() => setQuery(v))}
          style={{ padding: 0 }}
        >
          <div style={{ display: "flex", alignItems: "center", gap: 10, padding: 12 }}>
            <Search size={18} />
            <Command.Input
              placeholder="Buscar acciones… (Ctrl+K)"
              autoFocus
              style={{
                width: "100%",
                outline: "none",
                background: "transparent",
                border: "none",
                color: "inherit",
                fontSize: 14,
              }}
            />
            <span
              style={{
                opacity: 0.6,
                fontSize: 12,
                border: "1px solid rgba(255,255,255,0.15)",
                padding: "2px 8px",
                borderRadius: 999,
              }}
            >
              Esc
            </span>
          </div>

          <Command.List style={{ maxHeight: 380, overflow: "auto", padding: 8 }}>
            <Command.Empty style={{ padding: 16, opacity: 0.7 }}>
              No encontré nada con eso.
            </Command.Empty>

            {actions.map((a) => (
              <Command.Item
                key={a.id}
                value={[a.title, a.subtitle, ...(a.keywords || [])].filter(Boolean).join(" ")}
                onSelect={() => a.onRun()}
                style={{
                  display: "flex",
                  alignItems: "center",
                  gap: 12,
                  padding: "10px 12px",
                  borderRadius: 12,
                  cursor: "pointer",
                }}
              >
                <div
                  style={{
                    width: 32,
                    height: 32,
                    borderRadius: 10,
                    display: "grid",
                    placeItems: "center",
                    background: "rgba(255,255,255,0.06)",
                  }}
                >
                  {a.icon}
                </div>
                <div style={{ display: "flex", flexDirection: "column" }}>
                  <div style={{ fontSize: 14, fontWeight: 600 }}>{a.title}</div>
                  {a.subtitle ? (
                    <div style={{ fontSize: 12, opacity: 0.7 }}>{a.subtitle}</div>
                  ) : null}
                </div>
              </Command.Item>
            ))}
          </Command.List>
        </Command>
      </div>
    </div>
  )

  return createPortal(overlay, doc.body)
}


/* ===== FILE: src/shared/ui/slide/index.ts ===== */
export { SlideShell } from "./SlideShell";
export { SlideStage } from "./SlideStage";
export { DataBox, TextList, Pill } from "./SlideBlocks";

/* ===== FILE: src/shared/ui/slide/SlideBlocks.tsx ===== */
import React from "react";

export function DataBox(props: { title: string; children: React.ReactNode; tone?: "default" | "accent" | "gold" }) {
  const tone = props.tone ?? "default";
  const border =
    tone === "accent" ? "rgba(2,167,202,.45)" :
    tone === "gold" ? "rgba(171,123,38,.55)" :
    "var(--border)";

  return (
    <div
      className="h-panel"
      style={{
        padding: "18px 18px",
        borderColor: border,
        minHeight: 120,
      }}
    >
      <div style={{ fontSize: 14, color: "var(--muted)", letterSpacing: .3, marginBottom: 8 }}>
        {props.title}
      </div>
      <div style={{ fontSize: 18, color: "var(--text)", lineHeight: 1.35 }}>
        {props.children}
      </div>
    </div>
  );
}

export function TextList(props: { items: string[] }) {
  return (
    <ul style={{ margin: 0, paddingLeft: 20, color: "var(--text)", fontSize: 18, lineHeight: 1.55 }}>
      {props.items.map((t, i) => (
        <li key={i} style={{ marginBottom: 6, color: "var(--muted)" }}>
          <span style={{ color: "var(--text)" }}>{t}</span>
        </li>
      ))}
    </ul>
  );
}

export function Pill(props: { label: string; tone?: "accent" | "gold" | "muted" }) {
  const tone = props.tone ?? "muted";
  const bg =
    tone === "accent" ? "rgba(2,167,202,.20)" :
    tone === "gold" ? "rgba(171,123,38,.22)" :
    "rgba(255,255,255,.10)";

  const border =
    tone === "accent" ? "rgba(2,167,202,.35)" :
    tone === "gold" ? "rgba(171,123,38,.40)" :
    "rgba(255,255,255,.14)";

  return (
    <span
      style={{
        display: "inline-flex",
        alignItems: "center",
        gap: 8,
        padding: "6px 10px",
        borderRadius: 999,
        background: bg,
        border: `1px solid ${border}`,
        color: "var(--text)",
        fontSize: 13,
        letterSpacing: .25,
      }}
    >
      {props.label}
    </span>
  );
}


/* ===== FILE: src/shared/ui/slide/SlideShell.tsx ===== */
import type { ReactNode } from "react"
import { cn } from "@/shared/lib/cn"

export function SlideShell(props: {
  title?: string
  kicker?: string
  right?: ReactNode
  children: ReactNode
  footerLeft?: ReactNode
  footerRight?: ReactNode

  /** si false, no renderiza header/footer/card. Ideal para slides “cinematic”. */
  chrome?: boolean

  /** opcional */
  className?: string

  /** opcional: rig/grade para el stage */
  rig?: "night-studio"
  grade?: "contrast" | "soft"
}) {
  const chrome = props.chrome !== false

  if (!chrome) {
    return (
      <div
        className="hi-stage h-full w-full"
        data-hi-rig={props.rig ?? "night-studio"}
        data-hi-grade={props.grade ?? "contrast"}
      >
        <div className={cn("hi-screen h-full w-full", props.className)}>{props.children}</div>
      </div>
    )
  }

  return (
    <div
      className="hi-stage h-full w-full"
      data-hi-rig={props.rig ?? "night-studio"}
      data-hi-grade={props.grade ?? "contrast"}
    >
      <div className={cn("hi-screen h-full w-full p-10", props.className)}>
        <div
          data-material="glassCold"
          className="h-full w-full rounded-[var(--radius-xl)] border border-white/10 bg-white/5 shadow-[var(--shadow-soft)]"
        >
          <div className="grid h-full grid-rows-[auto_1fr_auto]">
            <header className="flex items-start justify-between gap-6 px-10 pt-8">
              <div className="min-w-0">
                {props.kicker ? (
                  <div className="text-xs font-medium tracking-wide opacity-75">{props.kicker}</div>
                ) : null}

                {props.title ? (
                  <div className="mt-2 text-3xl font-semibold leading-tight">{props.title}</div>
                ) : null}
              </div>

              {props.right ? <div className="shrink-0">{props.right}</div> : null}
            </header>

            <main className="min-h-0 px-10 py-8">{props.children}</main>

            <footer className="flex items-center justify-between gap-4 border-t border-white/10 px-10 py-5 text-xs opacity-75">
              <div>{props.footerLeft ?? <span className="tracking-wide">HITECH</span>}</div>
              <div>{props.footerRight ?? <span className="font-mono">1600x900</span>}</div>
            </footer>
          </div>
        </div>
      </div>
    </div>
  )
}


/* ===== FILE: src/shared/ui/slide/SlideStage.tsx ===== */
import { useEffect, useMemo, useRef, useState, type ReactNode } from "react"

import { cn } from "@/shared/lib/cn"

function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n))
}

export function SlideStage(props: {
  width: number
  height: number
  children: ReactNode
  rig?: "night-studio"
  grade?: "contrast" | "soft"
}) {
  const hostRef = useRef<HTMLDivElement | null>(null)
  const [hostSize, setHostSize] = useState({ w: 0, h: 0 })
  const { children, width, height } = props

  useEffect(() => {
    function measure() {
      const el = hostRef.current
      if (!el) return
      const r = el.getBoundingClientRect()
      setHostSize({ w: Math.round(r.width), h: Math.round(r.height) })
    }

    measure()

    const el = hostRef.current
    if (!el) return

    const ro = new ResizeObserver(() => measure())
    ro.observe(el)

    return () => {
      ro.disconnect()
    }
  }, [])

  const scale = useMemo(() => {
    const { w, h } = hostSize
    if (!w || !h) return 1
    const sx = w / width
    const sy = h / height
    return clamp(Math.min(sx, sy), 0.05, 3)
  }, [hostSize, width, height])

  // Renderizamos en tamaño original y escalamos visualmente
  return (
    <div
      ref={hostRef}
      className={cn("hi-stage relative w-full overflow-hidden rounded-xl")}
      data-hi-rig={props.rig ?? "night-studio"}
      data-hi-grade={props.grade ?? "contrast"}
      style={{
        minHeight: 240,
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
      }}
    >
      <div
        style={{
          width,
          height,
          transform: `scale(${scale})`,
          transformOrigin: "top left",
        }}
      >
        {children}
      </div>
    </div>
  )
}


/* ===== FILE: src/shared/ui/stage/board.frame.css ===== */
:root {
    --board-radius: 28px;

    --glass-bg: rgba(255, 255, 255, 0.025);
    --glass-border: rgba(255, 255, 255, 0.14);

    --rim-a: 0.55;
    --glare-a: 0.22;

    --star-a: 0.55;
    --sparkle-a: 0.75;

    --noise-a: 0.18;

    /* motes */
    --motes-a: 0.55;
    --motes-speed: 22s;
}

/* ===================================
   BOARD SHELL
=================================== */
.board-frame {
    position: relative;
    width: 100%;
    height: 100%;
    transform: translateZ(0);
}

.board-shadow {
    position: absolute;
    inset: -4%;
    background:
        radial-gradient(1300px 700px at 50% 88%, rgba(0, 0, 0, 0.65), transparent 70%),
        radial-gradient(900px 420px at 50% 15%, rgba(0, 0, 0, 0.35), transparent 72%);
    filter: blur(22px);
    opacity: 0.95;
}

.board-glass {
    position: absolute;
    inset: 0;
    border-radius: var(--board-radius);
    overflow: hidden;

    background: var(--glass-bg);
    border: 1px solid var(--glass-border);

    box-shadow:
        0 32px 140px rgba(0, 0, 0, 0.55),
        inset 0 1px 0 rgba(255, 255, 255, 0.10),
        inset 0 -1px 0 rgba(255, 255, 255, 0.06);

    backdrop-filter: blur(12px);
}

/* Rim light / edge glow */
.board-glass::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: var(--board-radius);
    pointer-events: none;
    background:
        radial-gradient(1200px 520px at 50% 0%, rgba(255, 255, 255, 0.16), transparent 62%),
        radial-gradient(900px 420px at 18% 28%, rgba(120, 190, 255, 0.12), transparent 62%),
        radial-gradient(900px 420px at 82% 28%, rgba(255, 180, 220, 0.10), transparent 62%),
        linear-gradient(180deg, rgba(255, 255, 255, 0.06), transparent 34%);
    opacity: var(--rim-a);
    mix-blend-mode: screen;
}

/* ===================================
   INSIDE GLASS: STARFIELD
=================================== */
.board-stars {
    position: absolute;
    inset: -12%;
    pointer-events: none;
    opacity: var(--star-a);
    mix-blend-mode: screen;
    filter: blur(0.2px);
    transform: translateZ(0);

    background-image:
        radial-gradient(1px 1px at 12% 18%, rgba(255, 255, 255, 0.60), transparent 45%),
        radial-gradient(1px 1px at 22% 72%, rgba(255, 255, 255, 0.30), transparent 45%),
        radial-gradient(1px 1px at 38% 44%, rgba(255, 255, 255, 0.26), transparent 45%),
        radial-gradient(1px 1px at 49% 12%, rgba(255, 255, 255, 0.50), transparent 45%),
        radial-gradient(1px 1px at 57% 63%, rgba(255, 255, 255, 0.28), transparent 45%),
        radial-gradient(1px 1px at 66% 28%, rgba(255, 255, 255, 0.32), transparent 45%),
        radial-gradient(1px 1px at 78% 58%, rgba(255, 255, 255, 0.22), transparent 45%),
        radial-gradient(1px 1px at 86% 22%, rgba(255, 255, 255, 0.28), transparent 45%),
        radial-gradient(1px 1px at 92% 76%, rgba(255, 255, 255, 0.22), transparent 45%),
        radial-gradient(1px 1px at 8% 86%, rgba(255, 255, 255, 0.20), transparent 45%),

        radial-gradient(3px 3px at 72% 78%, rgba(200, 230, 255, 0.14), transparent 70%),
        radial-gradient(3px 3px at 28% 74%, rgba(255, 220, 240, 0.12), transparent 70%),
        radial-gradient(2px 2px at 18% 30%, rgba(255, 255, 255, 0.12), transparent 62%);
}

/* ===================================
   SPARKLES / GLINTS
=================================== */
.board-sparkles {
    position: absolute;
    inset: -10%;
    pointer-events: none;
    opacity: 0.55;
    mix-blend-mode: screen;
    filter: blur(0.6px);
    animation: boardSparkle 10s ease-in-out infinite;

    background:
        radial-gradient(18px 18px at 22% 34%, rgba(255, 255, 255, 0.10), transparent 62%),
        radial-gradient(22px 22px at 68% 22%, rgba(200, 230, 255, 0.08), transparent 64%),
        radial-gradient(18px 18px at 84% 52%, rgba(255, 220, 240, 0.07), transparent 66%),
        radial-gradient(16px 16px at 35% 78%, rgba(255, 255, 255, 0.06), transparent 65%);
}

@keyframes boardSparkle {

    0%,
    100% {
        opacity: 0.35;
        transform: translate3d(0, 0, 0) scale(1);
    }

    50% {
        opacity: var(--sparkle-a);
        transform: translate3d(0.8%, -0.5%, 0) scale(1.02);
    }
}

/* ===================================
   MOTES (cosmic dust particles)
   - Muy sutiles
   - Movimiento lento
   - Dos pasadas para profundidad
=================================== */
.board-motes {
    position: absolute;
    inset: -18%;
    pointer-events: none;
    mix-blend-mode: screen;
    opacity: var(--motes-a);
    filter: blur(0.35px);

    /* 2 capas de motes: pequeños y medianos */
    background-image:
        radial-gradient(2px 2px at 12% 20%, rgba(255, 255, 255, 0.06), transparent 60%),
        radial-gradient(2px 2px at 18% 72%, rgba(255, 255, 255, 0.05), transparent 60%),
        radial-gradient(2px 2px at 38% 42%, rgba(255, 255, 255, 0.05), transparent 60%),
        radial-gradient(2px 2px at 56% 62%, rgba(255, 255, 255, 0.05), transparent 60%),
        radial-gradient(2px 2px at 74% 30%, rgba(255, 255, 255, 0.05), transparent 60%),
        radial-gradient(2px 2px at 86% 58%, rgba(255, 255, 255, 0.05), transparent 60%),

        radial-gradient(4px 4px at 22% 34%, rgba(200, 230, 255, 0.05), transparent 70%),
        radial-gradient(4px 4px at 70% 26%, rgba(255, 220, 240, 0.045), transparent 70%),
        radial-gradient(4px 4px at 62% 78%, rgba(255, 255, 255, 0.04), transparent 70%),
        radial-gradient(4px 4px at 34% 80%, rgba(255, 255, 255, 0.04), transparent 70%);

    animation: motesDrift var(--motes-speed) linear infinite;
    transform: translateZ(0);
}

@keyframes motesDrift {
    0% {
        transform: translate3d(-1.2%, 1.0%, 0) scale(1.02);
    }

    50% {
        transform: translate3d(1.1%, -0.8%, 0) scale(1.03);
    }

    100% {
        transform: translate3d(-1.2%, 1.0%, 0) scale(1.02);
    }
}

/* ===================================
   GLARE DIAGONAL
=================================== */
.board-glare {
    position: absolute;
    inset: -20%;
    pointer-events: none;
    opacity: var(--glare-a);
    mix-blend-mode: screen;
    filter: blur(1px);

    background:
        linear-gradient(120deg,
            transparent 0%,
            rgba(255, 255, 255, 0.05) 30%,
            rgba(255, 255, 255, 0.12) 42%,
            rgba(255, 255, 255, 0.05) 54%,
            transparent 70%);
    transform: translate3d(0, 0, 0) rotate(-6deg);
}

/* ===================================
   MICRO NOISE / SCRATCH FEEL
=================================== */
.board-noise {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: var(--noise-a);
    mix-blend-mode: overlay;
    border-radius: var(--board-radius);

    background:
        repeating-linear-gradient(90deg,
            rgba(255, 255, 255, 0.008) 0px,
            rgba(255, 255, 255, 0.008) 1px,
            transparent 2px,
            transparent 7px),
        radial-gradient(1200px 900px at 50% 50%, rgba(255, 255, 255, 0.02), transparent 70%);
}

/* ===================================
   INNER CONTENT WRAP
=================================== */
.board-inner {
    position: relative;
    z-index: 2;
    width: 100%;
    height: 100%;
}

/* ===================================
   REFLECTION
=================================== */
.board-reflection {
    position: absolute;
    left: -10%;
    right: -10%;
    bottom: -22%;
    height: 42%;
    pointer-events: none;
    transform: scaleY(-1);
    mix-blend-mode: screen;

    background:
        radial-gradient(800px 260px at 50% 0%, rgba(255, 255, 255, 0.12), transparent 70%),
        radial-gradient(900px 320px at 70% 25%, rgba(160, 220, 255, 0.06), transparent 74%),
        radial-gradient(900px 320px at 30% 25%, rgba(255, 200, 230, 0.05), transparent 74%);
    filter: blur(14px);
    opacity: 0.30;
}

/* reduce motion */
@media (prefers-reduced-motion: reduce) {

    .board-sparkles,
    .board-motes {
        animation: none !important;
    }
}

/* ===== FILE: src/shared/ui/stage/BoardFrame.tsx ===== */
import type { ReactNode } from "react"
import "./board.frame.css"

export function BoardFrame(props: { children: ReactNode }) {
    return (
        <div className="board-frame">
            <div className="board-shadow" />

            <div className="board-glass">
                {/* Universo dentro del vidrio */}
                <div className="board-stars" />
                <div className="board-sparkles" />
                <div className="board-motes" />
                <div className="board-glare" />
                <div className="board-noise" />

                {/* contenido real */}
                <div className="board-inner">{props.children}</div>

                {/* reflection */}
                <div className="board-reflection" />
            </div>
        </div>
    )
}


/* ===== FILE: src/shared/ui/stage/cosmic.stage.css ===== */
/* =========================================================
   FULLSCREEN UNIVERSE (cosmic.stage.css)
   Goal: deep starfield + nebula + sparkle + cinematic haze
   ========================================================= */

:root {
    --cosmic-bg: #05070c;
    --cosmic-ink: rgba(255, 255, 255, 0.06);

    /* knobs (tune fast) */
    --nebula-a: 0.14;
    --nebula-b: 0.10;
    --stars-fine-a: 0.85;
    --stars-fat-a: 0.55;
    --twinkle-a: 0.55;
    --dust-a: 0.16;
    --haze-a: 0.55;
    --vignette-a: 0.62;
    --grain-a: 0.09;
    --bloom-a: 0.80;

    /* board */
    --board-radius: 28px;
    --board-border: rgba(255, 255, 255, 0.11);
    --board-glass: rgba(255, 255, 255, 0.025);
    --board-shadow: rgba(0, 0, 0, 0.55);
}

@media (prefers-reduced-motion: reduce) {

    .cosmic-twinkle,
    .cosmic-drift,
    .cosmic-sparkle {
        animation: none !important;
    }
}

/* FULLSCREEN UNIVERSE */
.cosmic-stage {
    position: fixed;
    inset: 0;
    overflow: hidden;
    background: var(--cosmic-bg);
}

/* each layer */
.cosmic-layer {
    position: absolute;
    inset: -12%;
    pointer-events: none;
    transform: translateZ(0);
    will-change: transform, opacity, filter;
}

/* content host (scaled board lives above) */
.cosmic-content {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

/* -----------------------------
   1) BASE: deep space base + faint directional light
------------------------------ */
.cosmic-base {
    background:
        radial-gradient(1400px 900px at 18% 10%, rgba(255, 255, 255, 0.05), transparent 62%),
        radial-gradient(1200px 820px at 84% 6%, rgba(170, 200, 255, 0.05), transparent 64%),
        radial-gradient(1800px 1100px at 55% 75%, rgba(90, 110, 150, 0.05), transparent 70%),
        linear-gradient(180deg, rgba(0, 0, 0, 0.20), rgba(0, 0, 0, 0.55)),
        var(--cosmic-bg);
    opacity: 1;
}

/* -----------------------------
   2) NEBULA: richer colors, deeper blur, layered
------------------------------ */
.cosmic-nebula {
    background:
        radial-gradient(900px 650px at 25% 78%, rgba(120, 190, 255, var(--nebula-a)), transparent 68%),
        radial-gradient(900px 720px at 70% 28%, rgba(255, 160, 220, var(--nebula-b)), transparent 70%),
        radial-gradient(1100px 780px at 60% 88%, rgba(190, 220, 255, 0.08), transparent 72%),
        radial-gradient(800px 520px at 82% 62%, rgba(140, 255, 220, 0.05), transparent 70%);
    filter: blur(18px) saturate(1.18);
    opacity: 0.95;
    mix-blend-mode: screen;
}

/* subtle drift (parallax vibe without JS) */
.cosmic-drift {
    animation: drift 18s ease-in-out infinite;
}

@keyframes drift {

    0%,
    100% {
        transform: translate3d(0, 0, 0) scale(1.02);
    }

    50% {
        transform: translate3d(-1.2%, 0.8%, 0) scale(1.03);
    }
}

/* -----------------------------
   3) STARS: fine layer (many)
   (repeat the pattern by scaling layer slightly)
------------------------------ */
.cosmic-stars {
    background-image:
        radial-gradient(1px 1px at 12% 18%, rgba(255, 255, 255, 0.42), transparent 45%),
        radial-gradient(1px 1px at 22% 72%, rgba(255, 255, 255, 0.26), transparent 45%),
        radial-gradient(1px 1px at 38% 44%, rgba(255, 255, 255, 0.22), transparent 45%),
        radial-gradient(1px 1px at 49% 12%, rgba(255, 255, 255, 0.36), transparent 45%),
        radial-gradient(1px 1px at 57% 63%, rgba(255, 255, 255, 0.22), transparent 45%),
        radial-gradient(1px 1px at 66% 28%, rgba(255, 255, 255, 0.26), transparent 45%),
        radial-gradient(1px 1px at 78% 58%, rgba(255, 255, 255, 0.18), transparent 45%),
        radial-gradient(1px 1px at 86% 22%, rgba(255, 255, 255, 0.26), transparent 45%),
        radial-gradient(1px 1px at 92% 76%, rgba(255, 255, 255, 0.20), transparent 45%),
        radial-gradient(1px 1px at 8% 86%, rgba(255, 255, 255, 0.18), transparent 45%);
    opacity: var(--stars-fine-a);
    filter: blur(0.15px);
}

/* starfield duplicate pass (gives density) */
.cosmic-stars.cosmic-stars-2 {
    transform: scale(1.15);
    opacity: 0.55;
    filter: blur(0.25px);
}

/* -----------------------------
   4) BIG STARS / GLINTS: fat stars with bloom
------------------------------ */
.cosmic-fatstars {
    background-image:
        radial-gradient(2px 2px at 18% 30%, rgba(255, 255, 255, 0.20), transparent 62%),
        radial-gradient(2px 2px at 62% 22%, rgba(255, 255, 255, 0.16), transparent 62%),
        radial-gradient(2px 2px at 82% 40%, rgba(255, 255, 255, 0.18), transparent 62%),
        radial-gradient(3px 3px at 72% 78%, rgba(255, 255, 255, 0.12), transparent 66%),
        radial-gradient(3px 3px at 28% 74%, rgba(255, 255, 255, 0.10), transparent 66%),
        radial-gradient(4px 4px at 90% 18%, rgba(200, 230, 255, 0.11), transparent 70%),
        radial-gradient(4px 4px at 10% 58%, rgba(255, 220, 240, 0.10), transparent 70%);
    opacity: var(--stars-fat-a);
    filter: blur(0.2px);
    mix-blend-mode: screen;
}

/* -----------------------------
   5) TWINKLE: animate micro-opacity + tiny scale
------------------------------ */
.cosmic-twinkle {
    animation: twinkle 7s ease-in-out infinite;
    opacity: var(--twinkle-a);
}

@keyframes twinkle {

    0%,
    100% {
        opacity: 0.30;
        transform: translateZ(0) scale(1);
    }

    50% {
        opacity: 0.78;
        transform: translateZ(0) scale(1.01);
    }
}

/* -----------------------------
   6) SPARKLE: occasional tiny glints (very subtle)
------------------------------ */
.cosmic-sparkle {
    background:
        radial-gradient(10px 10px at 22% 34%, rgba(255, 255, 255, 0.08), transparent 62%),
        radial-gradient(14px 14px at 68% 22%, rgba(200, 230, 255, 0.06), transparent 64%),
        radial-gradient(12px 12px at 84% 52%, rgba(255, 220, 240, 0.06), transparent 66%),
        radial-gradient(10px 10px at 35% 78%, rgba(255, 255, 255, 0.05), transparent 65%);
    mix-blend-mode: screen;
    filter: blur(0.6px);
    opacity: 0.6;
    animation: sparkle 11s ease-in-out infinite;
}

@keyframes sparkle {

    0%,
    100% {
        opacity: 0.35;
        transform: translate3d(0, 0, 0) scale(1);
    }

    50% {
        opacity: 0.70;
        transform: translate3d(0.6%, -0.4%, 0) scale(1.02);
    }
}

/* -----------------------------
   7) DUST: subtle depth texture (no more diagonal jailbars)
------------------------------ */
.cosmic-dust {
    background:
        radial-gradient(900px 420px at 35% 88%, rgba(255, 255, 255, 0.05), transparent 72%),
        radial-gradient(700px 360px at 70% 84%, rgba(255, 255, 255, 0.04), transparent 74%),
        radial-gradient(850px 420px at 60% 40%, rgba(255, 255, 255, 0.03), transparent 76%);
    filter: blur(20px);
    opacity: var(--dust-a);
}

/* -----------------------------
   8) HAZE: lens haze / atmospheric glow
------------------------------ */
.cosmic-haze {
    background:
        radial-gradient(1600px 900px at 50% 45%, rgba(255, 255, 255, 0.04), transparent 68%),
        radial-gradient(1200px 700px at 60% 20%, rgba(160, 220, 255, 0.03), transparent 70%),
        radial-gradient(1200px 700px at 40% 80%, rgba(255, 180, 220, 0.025), transparent 72%);
    filter: blur(18px);
    opacity: var(--haze-a);
    mix-blend-mode: screen;
}

/* -----------------------------
   9) VIGNETTE: cinematic framing
------------------------------ */
.cosmic-vignette {
    background:
        radial-gradient(1200px 900px at 50% 40%, rgba(0, 0, 0, 0), rgba(0, 0, 0, var(--vignette-a)));
    opacity: 1;
}

/* -----------------------------
   10) GRAIN: subtle, non-band, film-like
------------------------------ */
.cosmic-grain {
    background:
        radial-gradient(1200px 900px at 50% 50%, rgba(255, 255, 255, 0.02), transparent 70%),
        repeating-linear-gradient(0deg,
            rgba(255, 255, 255, 0.010) 0px,
            rgba(255, 255, 255, 0.010) 1px,
            transparent 2px,
            transparent 6px);
    mix-blend-mode: overlay;
    opacity: var(--grain-a);
}

/* -----------------------------
   11) BLOOM: corner bloom for “expensive”
------------------------------ */
.cosmic-bloom {
    background:
        radial-gradient(900px 520px at 65% 18%, rgba(160, 220, 255, 0.06), transparent 66%),
        radial-gradient(700px 420px at 18% 22%, rgba(255, 200, 230, 0.05), transparent 70%);
    filter: blur(22px);
    opacity: var(--bloom-a);
    mix-blend-mode: screen;
}

/* =========================================================
   SCALER
   ========================================================= */

.scale-host {
    position: absolute;
    inset: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}

.scale-canvas {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: center center;
}

/* =========================================================
   BOARD (physical object feel)
   ========================================================= */

.board-frame {
    position: relative;
    width: 100%;
    height: 100%;
    transform: translateZ(0);
}

.board-shadow {
    position: absolute;
    inset: -3.5%;
    background:
        radial-gradient(1200px 620px at 50% 85%, var(--board-shadow), transparent 70%),
        radial-gradient(900px 420px at 50% 15%, rgba(0, 0, 0, 0.35), transparent 72%);
    filter: blur(20px);
    opacity: 0.95;
}

.board-glass {
    position: absolute;
    inset: 0;
    border-radius: var(--board-radius);
    border: 1px solid var(--board-border);
    background: var(--board-glass);
    box-shadow:
        0 30px 120px rgba(0, 0, 0, 0.45),
        inset 0 1px 0 rgba(255, 255, 255, 0.10);
    overflow: hidden;
    backdrop-filter: blur(10px);
}

/* inner rim light (thin) */
.board-glass::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: var(--board-radius);
    pointer-events: none;
    background:
        radial-gradient(1200px 500px at 50% 0%, rgba(255, 255, 255, 0.10), transparent 60%),
        linear-gradient(180deg, rgba(255, 255, 255, 0.06), transparent 35%);
    opacity: 0.55;
}

/* subtle chroma edge (very slight) */
.board-glass::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: var(--board-radius);
    pointer-events: none;
    background:
        radial-gradient(900px 420px at 20% 30%, rgba(120, 190, 255, 0.06), transparent 60%),
        radial-gradient(900px 420px at 80% 30%, rgba(255, 160, 220, 0.05), transparent 60%);
    mix-blend-mode: screen;
    opacity: 0.35;
}

.board-reflection {
    position: absolute;
    left: -10%;
    right: -10%;
    bottom: -22%;
    height: 42%;
    background:
        radial-gradient(800px 260px at 50% 0%, rgba(255, 255, 255, 0.10), transparent 70%),
        radial-gradient(900px 320px at 70% 25%, rgba(160, 220, 255, 0.06), transparent 74%),
        radial-gradient(900px 320px at 30% 25%, rgba(255, 200, 230, 0.05), transparent 74%);
    filter: blur(14px);
    opacity: 0.28;
    transform: scaleY(-1);
    mix-blend-mode: screen;
}

/* optional: micro noise on board to feel “material” */
.board-noise {
    position: absolute;
    inset: 0;
    border-radius: var(--board-radius);
    pointer-events: none;
    background:
        repeating-linear-gradient(90deg,
            rgba(255, 255, 255, 0.006) 0px,
            rgba(255, 255, 255, 0.006) 1px,
            transparent 2px,
            transparent 7px);
    opacity: 0.20;
    mix-blend-mode: overlay;
}

/* ===== FILE: src/shared/ui/stage/CosmicStage.tsx ===== */
import type { ReactNode } from "react"
import { cn } from "@/shared/lib/cn"
import "./cosmic.stage.css"

export function CosmicStage(props: {
    children: ReactNode
    grade?: "contrast" | "soft"
    className?: string
}) {
    return (
        <div className={cn("cosmic-stage", props.className)} data-hi-grade={props.grade ?? "contrast"}>
            {/* Layers back -> front */}
            <div className="cosmic-layer cosmic-base" />
            <div className="cosmic-layer cosmic-nebula cosmic-drift" />
            <div className="cosmic-layer cosmic-stars" />
            <div className="cosmic-layer cosmic-stars cosmic-stars-2" />
            <div className="cosmic-layer cosmic-fatstars cosmic-twinkle" />
            <div className="cosmic-layer cosmic-sparkle" />
            <div className="cosmic-layer cosmic-dust" />
            <div className="cosmic-layer cosmic-haze" />
            <div className="cosmic-layer cosmic-bloom" />
            <div className="cosmic-layer cosmic-vignette" />
            <div className="cosmic-layer cosmic-grain" />

            {/* Content (scaled board goes here) */}
            <div className="cosmic-content">{props.children}</div>
        </div>
    )
}


/* ===== FILE: src/shared/ui/stage/ScaleFrame.tsx ===== */
import { useEffect, useMemo, useRef, useState, type ReactNode } from "react"

function clamp(n: number, min: number, max: number) {
    return Math.max(min, Math.min(max, n))
}

export function ScaleFrame(props: {
    width: number
    height: number
    children: ReactNode
    mode?: "fit" | "fill"
    safety?: number // 0.82 – 0.9 recomendado
}) {
    const {
        width,
        height,
        children,
        mode = "fit",
        safety = 0.90, // ⭐ AQUÍ está la magia
    } = props

    const hostRef = useRef<HTMLDivElement | null>(null)
    const [size, setSize] = useState({ w: 0, h: 0 })

    useEffect(() => {
        const el = hostRef.current
        if (!el) return

        const measure = () => {
            const r = el.getBoundingClientRect()
            setSize({ w: r.width, h: r.height })
        }

        measure()
        const ro = new ResizeObserver(measure)
        ro.observe(el)
        return () => ro.disconnect()
    }, [])

    const scale = useMemo(() => {
        if (!size.w || !size.h) return 1

        const sx = size.w / width
        const sy = size.h / height
        const base =
            mode === "fill" ? Math.max(sx, sy) : Math.min(sx, sy)

        // 👇 safety es el UNDERSCAN real
        return clamp(base * safety, 0.4, 2)
    }, [size, width, height, mode, safety])

    return (
        <div
            ref={hostRef}
            className="absolute inset-0 flex items-center justify-center"
        >
            <div
                style={{
                    width,
                    height,
                    transform: `scale(${scale})`,
                    transformOrigin: "center center",
                }}
            >
                {children}
            </div>
        </div>
    )
}





/* ===== FILE: src/slides/slide-00/index.ts ===== */
import Slide00 from "./ui/Slide00"

export const meta = {
  id: "slide-00",
  title: "Portada",
  tags: ["intro"],
}

export default Slide00


/* ===== FILE: src/slides/slide-00/ui/Slide00.tsx ===== */
import { SlideShell } from "@/shared/ui/slide/SlideShell"
import { DataBox, Pill, TextList } from "@/shared/ui/slide/SlideBlocks"
import { BRAND } from "@/shared/config/constants"

export default function Slide00() {
  return (
    <SlideShell
      kicker="Inversion Next"
      title="Deck Engine prearmado"
      right={
        <div className="flex items-center gap-2">
          <Pill label="React" />
          <Pill label="Vite" />
          <Pill label="Tailwind" />
        </div>
      }
      footerRight={
        <span className="font-mono" style={{ color: BRAND.colors.teal600 }}>
          v0.1.0
        </span>
      }
    >
      <div className="grid h-full grid-cols-12 gap-6">
        <div className="col-span-7">
          <DataBox title="Qué es esto">
            <TextList
              items={[
                "SlideShell único para TODAS las slides.",
                "Constantes centralizadas en shared/config/constants.ts.",
                "Design tokens en shared/theme/tokens.css.",
                "Slide registry único con lazy import.",
              ]}
            />
          </DataBox>

          <div className="mt-6 grid grid-cols-2 gap-6">
            <DataBox title="Regla de oro">
              Una slide = una carpeta. Sin duplicados, sin magia rara.
            </DataBox>
            <DataBox title="Objetivo">
              Meter contenido rápido, consistente y visual, sin pelearte con la estructura.
            </DataBox>
          </div>
        </div>

        <div className="col-span-5">
          <DataBox title="Checklist de template">
            <TextList
              items={[
                "index.html + main.tsx conectados",
                "alias @ configurado",
                "puerto fijo 5177 (strict)",
                "router hash para deploy estático",
                "shadcn Button + Dialog listos",
              ]}
            />
          </DataBox>

          <div className="mt-6 rounded-2xl border border-white/10 bg-white/5 p-6">
            <div className="text-sm font-semibold">Tip para Codex</div>
            <div className="mt-2 text-sm opacity-90">
              Pídele que genere la slide completa dentro de{" "}
              <span className="font-mono">src/slides/slide-XX</span> y que registre en{" "}
              <span className="font-mono">slideRegistry.ts</span>.
            </div>
          </div>
        </div>
      </div>
    </SlideShell>
  )
}


/* ===== FILE: src/slides/slide-01/index.ts ===== */
import Slide01 from "./ui/Slide01"

export const meta = {
  id: "slide-01",
  title: "Agenda",
  tags: ["overview"],
}

export default Slide01


/* ===== FILE: src/slides/slide-01/ui/Slide01.tsx ===== */
import { SlideShell } from "@/shared/ui/slide/SlideShell"
import { DataBox, TextList } from "@/shared/ui/slide/SlideBlocks"
export default function Slide01() {
  return (
    <SlideShell kicker="Deck" title="Agenda (ejemplo)">
      <div className="grid h-full grid-cols-12 gap-6">
        <div className="col-span-6">
          <section data-material="glassCritical" data-glint="red">
          <DataBox title="Hoy">
            <TextList items={["Qué construimos", "Reglas de estructura", "Cómo agregar slides", "Cómo exportar"]} />
          </DataBox>
          </section>
        </div>
        <div className="col-span-6">
          <DataBox title="Mañana">
            <TextList items={["Flagships", "KPI dashboards", "Evidencias", "Módulos plug-in"]} />
          </DataBox>
        </div>
      </div>
    </SlideShell>
  )
}


/* ===== FILE: src/slides/slide-02/index.ts ===== */
import Slide02 from "./ui/Slide02"

export const meta = {
  id: "slide-02",
  title: "RTS: Executive Narrative",
  tags: ["rts", "executive"],
}

export default Slide02


/* ===== FILE: src/slides/slide-02/ui/Slide02.tsx ===== */
import { motion } from "framer-motion"
import { SlideShell } from "@/shared/ui/slide/SlideShell"
import { cn } from "@/shared/lib/cn"
import { useHiGrain } from "@/shared/hooks/useHiGrain"
import type { Slide02DashboardData } from "@/slides/slide-02/data/slide02.contract"
import { getSlide02Mock } from "@/slides/slide-02/data/slide02.mock"
import { useSlide02Seed } from "../data/slide02.seed"

export default function Slide02() {
  const seed = useSlide02Seed("slide02-v4")
  const data = getSlide02Mock(seed)// grain procedural (sin assets)
  useHiGrain({ size: 256, alpha: 0.18, seed: "slide02-v4" })

  return (
    <SlideShell
      title="Portfolio Overview"
      kicker="AI · Risk · Performance"
      // OJO: aquí dejamos hi-screen, pero idealmente SlideShell por dentro debería tener hi-stage
      className="hi-screen"
      footerLeft={<span className="tracking-wide">HITECH</span>}
      footerRight={<span className="font-mono">1600x900</span>}
    >
      <div className="relative grid h-full grid-cols-12 grid-rows-6 gap-6">
        <div className="hi-base-glass" aria-hidden="true" />

        <GlassPanel material="glassCold" className="col-span-5 row-span-2" title="Risk Summary">
          <RiskMock data={data.riskSummary} />
        </GlassPanel>

        <GlassPanel
          critical
          material="glassCritical"
          glint="silver"
          className="col-span-4 row-span-2"
          title="KPI Tracker"
        >
          <KpiDonut data={data.kpiTracker} />
        </GlassPanel>

        <GlassPanel material="glassCold" className="col-span-3 row-span-2" title="AI Better">
          <BarsAndSignal data={data.aiBetter} />
        </GlassPanel>

        <GlassPanel material="glassCold" className="col-span-5 row-span-4" title="Recent Activity">
          <ActivityMock data={data.recentActivity} />
        </GlassPanel>

        <GlassPanel material="glassCold" className="col-span-4 row-span-4" title="Portfolio Performance">
          {/* Mejor: highlight directo sobre el hi-chart para que se vea sí o sí */}
          <div data-chart-highlight="on" className="h-full">
            <PerfChart />
          </div>
        </GlassPanel>

        <GlassPanel material="glassCold" className="col-span-3 row-span-4" title="AI Insights">
          <InsightsMock data={data.aiInsights} />
        </GlassPanel>

        <div className="hi-mirror-wrap">
          <div className="hi-mirror" />
        </div>
      </div>
    </SlideShell>
  )
}

function GlassPanel(props: {
  title: string
  critical?: boolean
  material?: "glassCold" | "glassCritical"
  glint?: "silver" | "gold" | "emerald" | "cyan" | "red"
  className?: string
  children: React.ReactNode
}) {
  const isCritical = props.critical === true
  const material = isCritical ? "glassCritical" : "glassCold"
  const glint = isCritical ? props.glint ?? "silver" : undefined

  return (
    <motion.div
      whileHover={{ y: -2, scale: 1.01 }}
      transition={{ duration: 0.22, ease: "easeOut" }}
      data-material={material}
      data-glint={glint}
      className={cn(
        "hi-panel relative overflow-hidden",
        props.critical && "hi-panel-critical",
        props.className,
      )}
    >
      <div className="hi-inset" />
      <div className="hi-specular" />
      <div className="hi-rim" />
      <div className="hi-glassfx" />
      <div className="hi-grain" />
      <div className="hi-glints" />
      <div className="hi-glow" />

      <div className="relative z-10 h-full p-6">
        <div className="mb-4 text-sm font-medium tracking-wide opacity-80">{props.title}</div>
        {props.children}
      </div>
    </motion.div>
  )
}

function RiskMock({ data }: { data: Slide02DashboardData["riskSummary"] }) {
  const low = data.riskMix.find((entry) => entry.level === "Low")?.percent ?? 0
  const medium = data.riskMix.find((entry) => entry.level === "Medium")?.percent ?? 0
  const high = data.riskMix.find((entry) => entry.level === "High")?.percent ?? 0
  const deltaLabel = `${data.deltaThisMonth >= 0 ? "+" : ""}${data.deltaThisMonth} this month`

  return (
    <div className="grid h-full grid-cols-2 gap-4">
      <div className="rounded-[14px] bg-white/5 p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]">
        <div className="hi-dim text-xs">Active Risks</div>
        <div className="mt-2 text-4xl font-semibold">{data.activeRisks}</div>
        <div className="mt-2 inline-flex items-center gap-2 rounded-full bg-black/30 px-3 py-1 text-xs opacity-80">
          <span className="h-2 w-2 rounded-full bg-white/40" />
          {data.severity}
          <span className="hi-dim">{deltaLabel}</span>
        </div>
      </div>

      <div className="rounded-[14px] bg-white/5 p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]">
        <div className="hi-dim text-xs">Risk Mix</div>
        <div className="mt-3 space-y-3 text-xs">
          <BarRow label="Low" value={low} />
          <BarRow label="Medium" value={medium} />
          <BarRow label="High" value={high} />
        </div>
      </div>
    </div>
  )
}

function BarRow({ label, value }: { label: string; value: number }) {
  return (
    <div>
      <div className="flex items-center justify-between opacity-80">
        <span>{label}</span>
        <span className="hi-dim">{value}%</span>
      </div>
      <div className="mt-1 h-2 rounded-full bg-black/35">
        <div
          className="h-2 rounded-full"
          style={{
            width: `${value}%`,
            background: "linear-gradient(90deg, rgba(181,181,181,0.12), rgba(181,181,181,0.55))",
          }}
        />
      </div>
    </div>
  )
}

function KpiDonut({ data }: { data: Slide02DashboardData["kpiTracker"] }) {
  const ring = 2 * Math.PI * 44
  const compositeLabel = `${(data.composite * 100).toFixed(1)}%`
  const dashOffset = ring * (1 - data.donutProgress)

  return (
    <div className="grid h-full grid-cols-[1fr_170px] gap-4">
      <div className="flex items-center justify-center">
        <div className="relative h-44 w-44">
          <div className="absolute inset-0 rounded-full bg-white/5 shadow-[inset_0_1px_0_rgba(255,255,255,0.06),_0_18px_60px_rgba(0,0,0,0.55)]" />
          <svg className="absolute inset-0" viewBox="0 0 120 120">
            <defs>
              <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stopColor="rgba(255,255,255,0.70)" />
                <stop offset="0.35" stopColor="rgba(255,255,255,0.18)" />
                <stop offset="1" stopColor="rgba(181,181,181,0.55)" />
              </linearGradient>
              <filter id="softGlow">
                <feGaussianBlur stdDeviation="1.8" result="b" />
                <feColorMatrix
                  in="b"
                  type="matrix"
                  values="
                    1 0 0 0 0
                    0 1 0 0 0
                    0 0 1 0 0
                    0 0 0 0.55 0"
                  result="g"
                />
                <feMerge>
                  <feMergeNode in="g" />
                  <feMergeNode in="SourceGraphic" />
                </feMerge>
              </filter>
            </defs>

            <circle cx="60" cy="60" r="44" fill="none" stroke="rgba(255,255,255,0.10)" strokeWidth="10" />
            <circle
              cx="60"
              cy="60"
              r="44"
              fill="none"
              stroke="url(#g1)"
              strokeWidth="10"
              strokeLinecap="round"
              strokeDasharray={`${ring}`}
              strokeDashoffset={`${dashOffset}`}
              transform="rotate(-90 60 60)"
              filter="url(#softGlow)"
            />
          </svg>

          <div className="absolute inset-[18px] rounded-full bg-black/45 backdrop-blur-[10px] shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]" />
          <div className="absolute inset-0 flex items-center justify-center">
            <div className="text-center">
              <div className="text-3xl font-semibold">{compositeLabel}</div>
              <div className="hi-dim mt-1 text-xs">KPI composite</div>
            </div>
          </div>

          <div className="absolute inset-0 rounded-full opacity-70 [background:radial-gradient(closest-side_at_50%_0%,rgba(255,255,255,0.18),transparent_58%)]" />
        </div>
      </div>

      <div className="space-y-2">
        <Pill label={data.forecast.label} value={formatValue(data.forecast)} />
        <Pill label={data.target.label} value={formatValue(data.target)} />
        <Pill label={data.actual.label} value={formatValue(data.actual)} />
        <div className="mt-3 rounded-[14px] bg-white/5 p-3 text-xs opacity-80">
          Confidence: <span className="text-white/80">{data.confidence}</span> · Drift:{" "}
          <span className="text-white/80">{data.drift}</span>
        </div>
      </div>
    </div>
  )
}

function Pill({ label, value }: { label: string; value: string }) {
  return (
    <div className="flex items-center justify-between rounded-[14px] bg-white/5 px-3 py-2 text-xs shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]">
      <span className="hi-dim">{label}</span>
      <span className="font-mono text-white/80">{value}</span>
    </div>
  )
}

function BarsAndSignal({ data }: { data: Slide02DashboardData["aiBetter"] }) {
  return (
    <div className="grid h-full grid-rows-[auto_auto_1fr] gap-3">
      <div className="space-y-2 text-xs opacity-80">
        {data.kpiBars.map((bar) => (
          <MiniBar key={bar.label} label={bar.label} value={bar.percent} right={formatValue(bar)} />
        ))}
      </div>

      <div className="hi-dim text-xs">Signal</div>

      <div className="hi-chart h-full w-full">
        <svg className="h-full w-full" viewBox="0 0 100 40" preserveAspectRatio="none">
          <path
            d="M0,32 C10,30 20,28 30,29 C40,30 50,22 60,20 C70,18 80,19 90,16 C95,15 98,14 100,13 L100,40 L0,40 Z"
            fill="rgba(181,181,181,0.14)"
          />
          <path
            d="M0,32 C10,30 20,28 30,29 C40,30 50,22 60,20 C70,18 80,19 90,16 C95,15 98,14 100,13"
            fill="none"
            stroke="rgba(181,181,181,0.55)"
            strokeWidth="1.4"
          />
        </svg>
      </div>
    </div>
  )
}

function MiniBar({ label, value, right }: { label: string; value: number; right: string }) {
  return (
    <div>
      <div className="flex items-center justify-between">
        <span>{label}</span>
        <span className="hi-dim font-mono">{right}</span>
      </div>
      <div className="mt-1 h-2 rounded-full bg-black/35">
        <div
          className="h-2 rounded-full"
          style={{
            width: `${value}%`,
            background: "linear-gradient(90deg, rgba(181,181,181,0.10), rgba(181,181,181,0.55))",
          }}
        />
      </div>
    </div>
  )
}

function ActivityMock({ data }: { data: Slide02DashboardData["recentActivity"] }) {
  return (
    <div className="space-y-3">
      {data.items.map((item) => (
        <ActivityRow key={item.timestamp} title={item.title} meta={`${item.timeAgo} · ${item.detail}`} />
      ))}
    </div>
  )
}

function ActivityRow({ title, meta }: { title: string; meta: string }) {
  return (
    <div className="rounded-[14px] bg-white/5 p-4 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]">
      <div className="text-sm opacity-85">{title}</div>
      <div className="hi-dim mt-1 text-xs">{meta}</div>
    </div>
  )
}

function PerfChart() {
  return (
    <div className="hi-chart h-full w-full">
      <svg className="h-full w-full" viewBox="0 0 100 60" preserveAspectRatio="none">
        <path
          d="M0,50 C10,48 20,47 30,44 C40,40 50,38 60,34 C70,30 80,28 90,24 C95,22 98,21 100,20 L100,60 L0,60 Z"
          fill="rgba(181,181,181,0.10)"
        />
        <path
          d="M0,50 C10,48 20,47 30,44 C40,40 50,38 60,34 C70,30 80,28 90,24 C95,22 98,21 100,20"
          fill="none"
          stroke="rgba(255,255,255,0.45)"
          strokeWidth="1.2"
        />
      </svg>
    </div>
  )
}

function InsightsMock({ data }: { data: Slide02DashboardData["aiInsights"] }) {
  return (
    <div className="grid h-full grid-rows-[auto_1fr] gap-3">
      <div className="rounded-[14px] bg-white/5 p-4 text-xs opacity-80 shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]">
        {data.summaryPrefix} <span className="text-white/85">{data.highlightPercent}%</span> {data.summarySuffix}
        <div className="hi-dim mt-2">
          Confidence: {data.confidence.toFixed(2)} · Source: {data.source}
        </div>
      </div>
      <div className="hi-chart" />
    </div>
  )
}

type DisplayValue =
  | Slide02DashboardData["kpiTracker"]["forecast"]
  | Slide02DashboardData["aiBetter"]["kpiBars"][number]

function formatValue(metric: DisplayValue) {
  if ("rightValue" in metric) {
    if (metric.rightDisplay) return metric.rightDisplay
    if (metric.rightUnit) return `${metric.rightValue}${metric.rightUnit}`
    return `${metric.rightValue}`
  }
  if (metric.display) return metric.display
  if (metric.unit) return `${metric.value}${metric.unit}`
  return `${metric.value}`
}



/* ===== FILE: src/slides/slide-03/index.ts ===== */
import Slide03 from "./ui/Slide03"

export const meta = {
  id: "slide-03",
  title: "RTS: Problem / Context",
  tags: ["rts", "context"],
}

export default Slide03


/* ===== FILE: src/slides/slide-03/ui/Slide03.tsx ===== */
import { ProblemSolutionTemplate } from "@/rts/slides/templates"

export function Slide03() {
  return (
    <ProblemSolutionTemplate
      title="Problem / Context"
      breadcrumb="RTS BLOCK 2"
      slideNum={3}
      problem="Evidence is scattered across tools, review cycles are slow, and risk language varies by team. The current workflow makes it hard to move from signal to decision with confidence."
      solution="Create a single narrative spine that aligns owners, evidence, and decisions. Block 2 focuses on a shared context so every review starts from the same facts."
      risks={[
        "Fragmented ownership delays approvals.",
        "Evidence trails are inconsistent across teams.",
        "Priority shifts without a shared risk vocabulary.",
      ]}
    />
  )
}

export default Slide03


/* ===== FILE: src/slides/slide-04/index.ts ===== */
import Slide04 from "./ui/Slide04"

export const meta = {
  id: "slide-04",
  title: "RTS: Solution / System Overview",
  tags: ["rts", "solution"],
}

export default Slide04


/* ===== FILE: src/slides/slide-04/ui/Slide04.tsx ===== */
import { SystemOverviewStaticTemplate } from "@/rts/slides/templates"

export function Slide04() {
  return <SystemOverviewStaticTemplate title="Solution / System Overview" breadcrumb="RTS BLOCK 2" slideNum={4} />
}

export default Slide04


/* ===== FILE: src/slides/slide-05/index.ts ===== */
import Slide05 from "./ui/Slide05"

export const meta = {
  id: "slide-05",
  title: "RTS: KPI Dashboard",
  tags: ["rts", "kpi"],
}

export default Slide05


/* ===== FILE: src/slides/slide-05/ui/Slide05.tsx ===== */
import { KpiGridTemplate } from "@/rts/slides/templates"
import { Stack } from "@/rts/ui/Stack"
import { Text } from "@/rts/ui/Text"

const kpis: Array<{
  label: string
  value: string
  hint: string
  state: "muted" | "critical" | "stable" | "watch" | "alert"
}> = [
  { label: "Decision readiness", value: "Baseline", hint: "Evidence mapped", state: "watch" },
  { label: "Review cycle", value: "In progress", hint: "Ops to exec", state: "stable" },
  { label: "Risk coverage", value: "Target set", hint: "Core domains", state: "muted" },
  { label: "Signal quality", value: "Watch", hint: "Noise reduced", state: "watch" },
  { label: "Control adoption", value: "Pilot", hint: "Active squads", state: "stable" },
  { label: "Audit trail", value: "Planned", hint: "Source tags", state: "muted" },
]

export function Slide05() {
  return (
    <KpiGridTemplate
      title="KPI Dashboard"
      breadcrumb="RTS BLOCK 2"
      slideNum={5}
      kpis={kpis}
      left={
        <Stack gap={16}>
          <Text variant="body">
            This dashboard tracks readiness, speed, and adoption without exposing final numbers yet. Each card is a placeholder tied
            to an evidence source.
          </Text>

          <div className="vs-surface" style={{ padding: 16, borderRadius: 16 }}>
            <Text variant="micro" className="vs-muted">
              Status logic
            </Text>
            <Text variant="body">Stable means monitored, Watch means attention needed, Alert means action required.</Text>
          </div>

          <details className="vs-surface" style={{ padding: 16, borderRadius: 16 }}>
            <summary className="vs-micro vs-muted cursor-pointer">Assumptions</summary>
            <div style={{ marginTop: 8 }}>
              <Text variant="body">KPIs stay directional until evidence owners confirm definitions and sources.</Text>
            </div>
          </details>
        </Stack>
      }
    />
  )
}

export default Slide05


/* ===== FILE: src/slides/slide-06/index.ts ===== */
import Slide06 from "./ui/Slide06"

export const meta = {
  id: "slide-06",
  title: "RTS: Timeline / Roadmap",
  tags: ["rts", "roadmap"],
}

export default Slide06


/* ===== FILE: src/slides/slide-06/ui/Slide06.tsx ===== */
import { motion } from "framer-motion"
import { SlideShell } from "@/shared/ui/slide/SlideShell"
import { cn } from "@/shared/lib/cn"

export default function Slide06() {
  return (
    <SlideShell
      title="Portfolio Overview"
      kicker="AI · Risk · Performance"
      className="hi-screen"
      footerLeft={<span className="tracking-wide">HITECH</span>}
      footerRight={<span className="font-mono">1600×900</span>}
    >
      <div className="relative grid h-full grid-cols-12 grid-rows-6 gap-6">
        {/* PANEL DOMINANTE */}
        <GlassPanel
          critical
          className="col-span-5 row-span-3"
          title="KPI Tracker"
        >
          <DonutMock />
        </GlassPanel>

        {/* PANEL DERECHO ARRIBA */}
        <GlassPanel className="col-span-4 row-span-2" title="AI Better">
          <BarsMock />
        </GlassPanel>

        {/* PANEL DERECHO MEDIO */}
        <GlassPanel className="col-span-3 row-span-2" title="AI Insights">
          <LineMock />
        </GlassPanel>

        {/* PANEL INFERIOR */}
        <GlassPanel className="col-span-7 row-span-3" title="Portfolio Performance">
          <ChartMock />
        </GlassPanel>

        {/* PANEL ACTIVIDAD */}
        <GlassPanel className="col-span-5 row-span-3" title="Recent Activity">
          <ListMock />
        </GlassPanel>

        {/* REFLEJO ESPEJO */}
        <MirrorReflection />
      </div>
    </SlideShell>
  )
}

/* ────────────────────────────────────────────── */
/* COMPONENTES BASE */
/* ────────────────────────────────────────────── */

function GlassPanel(props: {
  title: string
  critical?: boolean
  className?: string
  children: React.ReactNode
}) {
  return (
    <motion.div
      whileHover={{ y: -2, scale: 1.01 }}
      transition={{ duration: 0.25, ease: "easeOut" }}
      className={cn(
        "relative overflow-hidden rounded-[18px]",
        "hi-panel hi-glassfx hi-rim hi-grain",
        props.critical && "hi-panel-critical",
        props.className
      )}
    >
      {/* HIGHLIGHT SUPERIOR */}
      <div className="hi-specular pointer-events-none" />

      {/* CONTENIDO */}
      <div className="relative z-10 h-full p-6">
        <div className="mb-4 text-sm font-medium tracking-wide opacity-80">
          {props.title}
        </div>
        {props.children}
      </div>

      {/* GLOW EXTERNO */}
      <div className="hi-glow pointer-events-none" />
    </motion.div>
  )
}

/* ────────────────────────────────────────────── */
/* MOCKS VISUALES (luego los conectas a data real) */
/* ────────────────────────────────────────────── */

function DonutMock() {
  return (
    <div className="relative mx-auto h-40 w-40 rounded-full bg-gradient-to-br from-white/20 to-white/5 shadow-inner">
      <div className="absolute inset-4 rounded-full bg-black/60 backdrop-blur-sm" />
      <div className="absolute inset-0 rounded-full hi-chart" />
      <div className="absolute inset-0 flex items-center justify-center text-2xl font-semibold">
        72%
      </div>
    </div>
  )
}

function BarsMock() {
  return (
    <div className="flex h-full items-end gap-2">
      {[60, 40, 80].map((h, i) => (
        <div
          key={i}
          className="w-4 rounded-sm bg-gradient-to-t from-cyan-400/40 to-cyan-200/80 shadow"
          style={{ height: `${h}%` }}
        />
      ))}
    </div>
  )
}

function LineMock() {
  return (
    <div className="h-full w-full rounded-md bg-gradient-to-br from-white/10 to-transparent shadow-inner" />
  )
}

function ChartMock() {
  return (
    <div className="relative h-full w-full rounded-md bg-gradient-to-br from-white/10 to-black/40 shadow-inner">
      <div className="absolute inset-0 hi-chart" />
    </div>
  )
}

function ListMock() {
  return (
    <ul className="space-y-2 text-sm opacity-80">
      <li>• Mitigation plan initiated</li>
      <li>• New trade executed</li>
      <li>• KPI report generated</li>
    </ul>
  )
}

/* ────────────────────────────────────────────── */
/* REFLEJO ESPEJO (blur + fade) */
/* ────────────────────────────────────────────── */

function MirrorReflection() {
  return (
    <div className="pointer-events-none absolute inset-x-0 -bottom-10 h-40 scale-y-[-1] opacity-30 blur-xl">
      <div className="h-full w-full rounded-[18px] bg-white/10" />
    </div>
  )
}


/* ===== FILE: src/slides/slide-07/index.ts ===== */
import Slide07 from "./ui/Slide07"

export const meta = {
  id: "slide-07",
  title: "RTS: Risks and Next Steps",
  tags: ["rts", "risks"],
}

export default Slide07


/* ===== FILE: src/slides/slide-07/ui/Slide07.tsx ===== */
import { RiskRegisterTemplate } from "@/rts/slides/templates"
import type { RiskItem } from "@/rts/foundation/smartservices_types"

const risks: RiskItem[] = [
  {
    id: "RISK-101",
    label: "Evidence ownership unclear for priority decisions",
    state: "Watch",
    owner: "Owner: Program Lead",
    probability: "Medium",
    impact: "High",
    mitigation: "Assign owners per domain and publish evidence map",
    evidenceRef: "Pending",
  },
  {
    id: "RISK-102",
    label: "Inconsistent definitions across ops and exec reviews",
    state: "Alert",
    owner: "Owner: Ops Lead",
    probability: "High",
    impact: "Medium",
    mitigation: "Lock vocabulary and enforce review checklist",
    evidenceRef: "Draft",
  },
  {
    id: "RISK-103",
    label: "Dashboard signals drift without validation cycle",
    state: "Watch",
    owner: "Owner: Data Lead",
    probability: "Medium",
    impact: "Medium",
    mitigation: "Run weekly validation and log evidence exceptions",
    evidenceRef: "Planned",
  },
  {
    id: "RISK-104",
    label: "Decision cadence stalls during handoff",
    state: "Watch",
    owner: "Owner: PMO",
    probability: "Low",
    impact: "Medium",
    mitigation: "Set escalation path and publish calendar",
    evidenceRef: "Pending",
  },
]

export function Slide07() {
  return (
    <RiskRegisterTemplate
      title="Risks and Next Steps"
      breadcrumb="RTS BLOCK 2"
      slideNum="07"
      intro="Risks are tracked as categorical bands with clear owners and next actions. Mitigations focus on evidence integrity and decision flow."
      risks={risks}
      footer="Next steps: confirm owners, validate evidence sources, and lock the review cadence for the pilot window."
    />
  )
}

export default Slide07


/* ===== FILE: src/vite-env.d.ts ===== */
/// <reference types="vite/client" />

declare module "*.css";


/* ===== FILE: src/widgets/slide-nav/ui/SlideNav.tsx ===== */
import { Button } from "@/components/ui/button"

export function SlideNav(props: {
  index: number
  total: number
  onPrev: () => void
  onNext: () => void
}) {
  const atStart = props.index <= 0
  const atEnd = props.index >= props.total - 1

  return (
    <div className="flex items-center gap-2">
      <Button data-deck-prev variant="secondary" size="sm" onClick={props.onPrev} disabled={atStart}>
        ← Prev
      </Button>
      <Button data-deck-next variant="default" size="sm" onClick={props.onNext} disabled={atEnd}>
        Next →
      </Button>
    </div>
  )
}


/* ===== FILE: tsconfig.app.json ===== */
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "jsx": "react-jsx",
    "useDefineForClassFields": true,
    "strict": true,
    "noUncheckedIndexedAccess": false,
    "exactOptionalPropertyTypes": false,
    "noEmit": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "skipLibCheck": true,
    "resolveJsonModule": true,
    "allowImportingTsExtensions": true,
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "./src/*"
      ]
    },
    "types": [
      "vite/client"
    ]
  },
  "include": [
    "src"
  ],
  "exclude": [
    ".hitech-backups",
    "scripts/hitech-templates",
    "hitech-templates",
    "scripts/hitech-templates__backup_*",
    "dist",
    "build",
    "coverage"
  ]
}


/* ===== FILE: tsconfig.json ===== */
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "exclude": [
    ".hitech-backups",
    "scripts/hitech-templates",
    "hitech-templates",
    "scripts/hitech-templates__backup_*"
  ]
}


/* ===== FILE: tsconfig.node.json ===== */
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2022",
    "lib": ["ES2022"],
    "module": "ESNext",
    "skipLibCheck": true,

    "moduleResolution": "Bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    "strict": true
  },
  "include": ["vite.config.ts"],
  "exclude": [
    ".hitech-backups",
    "scripts/hitech-templates",
    "hitech-templates",
    "scripts/hitech-templates__backup_*"
  ]
}


/* ===== FILE: vite.config.ts ===== */
import path from "path"
import react from "@vitejs/plugin-react"
import tailwindcss from "@tailwindcss/vite"
import { defineConfig } from "vitest/config"


export default defineConfig({
  plugins: [react(), tailwindcss()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  server: {
    port: 5177,
    strictPort: true,
    fs: {
      deny: [
        "**/.hitech-backups/**",
        "**/scripts/hitech-templates/**",
        "**/hitech-templates/**",
        "**/scripts/hitech-templates__backup_*/**",
      ],
    },
  },
  test: {
    environment: "jsdom",
    globals: true,
    setupFiles: ["./src/tests/setup.ts"],
  },
})
